<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring å­¦ä¹ ç¬”è®° - Java çŸ¥è¯†åº“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            line-height: 1.7;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            overflow: hidden;
            width: 100%;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2.5rem 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: #f5f7fa;
            border-bottom: 2px solid #e1e4e8;
        }
        
        .tab {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            background: transparent;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            background: rgba(102, 126, 234, 0.05);
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            background: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }
        
        /* Content Area */
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: flex;
        }
        
        .layout {
            display: flex;
            min-height: 70vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid #e1e4e8;
            overflow-y: auto;
            height: calc(100vh - 180px);
            flex-shrink: 0;
        }
        
        .sidebar-title {
            padding: 1.2rem 1rem;
            background: white;
            border-bottom: 2px solid #e1e4e8;
            font-weight: 700;
            color: #667eea;
            font-size: 0.95rem;
        }
        
        .toc-tree {
            padding: 1rem 0;
        }
        
        .toc-link {
            display: block;
            padding: 0.5rem 1rem;
            color: #555;
            text-decoration: none;
            font-size: 0.88rem;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .toc-link:hover {
            background: rgba(102, 126, 234, 0.08);
            color: #667eea;
            border-left-color: #667eea;
        }
        
        .toc-link.level-1 {
            font-weight: 600;
            margin-top: 0.5rem;
        }
        
        .toc-num {
            color: #667eea;
            font-weight: 600;
            margin-right: 0.4rem;
        }
        
        .toc-text {
            word-break: break-word;
        }
        
        /* Main Content */
        .main {
            flex: 1;
            padding: 2.5rem 3rem;
            overflow-y: auto;
            height: calc(100vh - 180px);
            overflow-x: hidden;
            max-width: 100%;
        }
        
        .heading {
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e8e8e8;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .heading.level-1 {
            font-size: 1.8rem;
            color: #667eea;
            border-bottom-width: 3px;
        }
        
        .heading.level-2 {
            font-size: 1.4rem;
        }
        
        .heading.level-3 {
            font-size: 1.2rem;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .main p {
            margin: 0.6rem 0;
            line-height: 1.8;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }
        
        .main .gap {
            height: 0.8rem;
        }
        
        .main pre {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            line-height: 1.5;
        }
        
        .main code {
            font-family: "SF Mono", Monaco, Consolas, "Courier New", monospace;
            font-size: 0.9em;
            color: #24292e;
        }
        
        /* Footer */
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
        }
        
        /* Mobile Toggle */
        .mobile-toc-toggle {
            display: none;
            background: #667eea;
            color: white;
            border: none;
            padding: 0.8rem 1rem;
            width: 100%;
            text-align: left;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .mobile-toc-toggle:active {
            background: #5568d3;
        }
        
        .toc-tree.collapsed {
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            
            .main {
                padding: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .container {
                margin: 0;
                border-radius: 0;
                width: 100%;
                max-width: 100vw;
            }
            
            .layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: none;
                border-right: none;
                border-bottom: 2px solid #e1e4e8;
            }
            
            .sidebar-title {
                display: none;
            }
            
            .mobile-toc-toggle {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .toc-tree {
                max-height: 60vh;
                overflow-y: auto;
            }
            
            .main {
                padding: 1rem;
                height: auto;
                overflow-y: visible;
                overflow-x: hidden;
                word-wrap: break-word;
                overflow-wrap: break-word;
                max-width: 100vw;
                box-sizing: border-box;
            }
            
            .main * {
                max-width: 100%;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .main p {
                word-wrap: break-word;
                overflow-wrap: break-word;
                word-break: break-word;
                max-width: 100%;
            }
            
            .main pre {
                font-size: 0.85rem;
                overflow-x: auto;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            
            .main code {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .toc-link {
                white-space: normal;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .header h1 {
                font-size: 1.8rem;
                word-wrap: break-word;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .tab {
                padding: 0.8rem 0.5rem;
                font-size: 0.9rem;
            }
            
            .heading {
                word-wrap: break-word;
                overflow-wrap: break-word;
                word-break: break-word;
            }
        }
        
        /* Scrollbar Style */
        .main::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        
        .main::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .main::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .main::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Spring å­¦ä¹ ç¬”è®°</h1>
            <p>Java æ ¸å¿ƒçŸ¥è¯† Â· Spring æ¡†æ¶ç²¾è®² Â· é¢è¯•å¿…å¤‡</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">ğŸ“š åŸºç¡€ç¯‡</button>
            <button class="tab" onclick="switchTab(1)">ğŸ’¼ é¢å‘æ‹›è˜</button>
        </div>
        
        <!-- åŸºç¡€ç¯‡ -->
        <div class="tab-panel active">
            <div class="layout">
                <aside class="sidebar">
                    <div class="sidebar-title">ğŸ“‘ ç›®å½•å¯¼èˆª</div>
                    <button class="mobile-toc-toggle" onclick="toggleToc(this)">
                        <span>ğŸ“‘ ç›®å½•å¯¼èˆª</span>
                        <span class="toggle-icon">â–¼</span>
                    </button>
                    <div class="toc-tree">
        <a href="#h-1" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">1</span>
            <span class="toc-text">æŒæ¡ Java æ ¸å¿ƒçŸ¥è¯†</span>
        </a>
        <a href="#h-2" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">2</span>
            <span class="toc-text">å­¦ä¹  Spring Core å’Œ DI/AOP æ¦‚å¿µ</span>
        </a>
        <a href="#h-3" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">3</span>
            <span class="toc-text">å®è·µ Spring MVC å¼€å‘ Web åº”ç”¨</span>
        </a>
        <a href="#h-4" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">4</span>
            <span class="toc-text">å­¦ä¹  Spring Data è¿›è¡Œæ•°æ®åº“æ“ä½œ</span>
        </a>
        <a href="#h-5" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">5</span>
            <span class="toc-text">æŒæ¡ Spring Boot ç®€åŒ–å¼€å‘æµç¨‹</span>
        </a>
        <a href="#h-6" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">6</span>
            <span class="toc-text">æ¢ç´¢ Spring Cloud æ„å»ºå¾®æœåŠ¡</span>
        </a></div>
                </aside>
                <main class="main">
                    <h2 id="h-1" class="heading level-1">1. æŒæ¡ Java æ ¸å¿ƒçŸ¥è¯†</h2>
<p>1.1 IoC æ§åˆ¶åè½¬ï¼šä¸€ç§è®¾è®¡æ€æƒ³/åŸåˆ™ã€‚</p>
<p>æ ¸å¿ƒï¼šå¯¹è±¡ä¸åˆ›å»ºä¾èµ–ï¼Œè€Œæ˜¯ä¾èµ–ç”±â€œå¤–éƒ¨å®¹å™¨â€æä¾›ã€‚</p>
<div class="gap"></div>
<p>DI ä¾èµ–æ³¨å…¥ï¼šæ˜¯å®ç°IoCçš„ä¸»è¦æŠ€æœ¯æ‰‹æ®µã€‚Springä½¿ç”¨DIæ¥å®ç°IoCã€‚</p>
<div class="gap"></div>
<pre><code>class UserService {
    private UserRepository repo;

    public UserService(UserRepository repo) {
        this.repo = repo;
    }
}</code></pre>
<div class="gap"></div>
<p>ç„¶åç”± Spring æ¥åšè¿™ä»¶äº‹ï¼š</p>
<pre><code>@Bean</code></pre>
<pre><code>public UserService userService(UserRepository repo) {
    return new UserService(repo);
}</code></pre>
<div class="gap"></div>
<p>1.2 é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP, Aspect Oriented Programming)ï¼šæ”¯æŒæ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–</p>
<p>Spring AOP = åœ¨ä¸æ”¹ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™æ–¹æ³•â€œå¤–æŒ‚â€ä¸€æ®µé€»è¾‘</p>
<div class="gap"></div>
<p>æ¯”å¦‚ï¼š</p>
<p>æ‰“æ—¥å¿—</p>
<p>ç»Ÿè®¡è€—æ—¶</p>
<p>æƒé™æ ¡éªŒ</p>
<p>äº‹åŠ¡æ§åˆ¶</p>
<div class="gap"></div>
<pre><code>@Around æ˜¯æœ€å¼ºçš„ Adviceï¼Œäº‹åŠ¡ã€é‡è¯•ã€ç¼“å­˜ï¼Œå¿…é¡»ç”¨ @Aroundã€‚</code></pre>
<div class="gap"></div>
<p>1.3 volatile ä¿®é¥°ç¬¦</p>
<pre><code>public class MyRunnable implements Runnable
{
    private volatile boolean active;
    public void run()
    {
        active = true;
        while (active) // ç¬¬ä¸€è¡Œ
        {
            // ä»£ç 
        }
    }
    public void stop()
    {
        active = false; // ç¬¬äºŒè¡Œ
    }
}</code></pre>
<div class="gap"></div>
<p>å¤šçº¿ç¨‹ï¼š</p>
<p>run() åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œè·‘</p>
<p>stop() åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œè°ƒç”¨</p>
<div class="gap"></div>
<p>å¤šçº¿ç¨‹åŒäº«åŒä¸€ä¸ªå˜é‡ activeã€‚è¿™æ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ çš„èƒ½åŠ›ã€‚</p>
<div class="gap"></div>
<p>å¦‚æœæ²¡æœ‰volatileï¼ŒJVMä¼šæŠŠ active ç¼“å­˜åœ¨CPUå¯„å­˜å™¨é‡Œï¼Œå¯¼è‡´whileæ°¸è¿œè¯»ä¸åˆ°falseã€‚volatileä¿è¯ä¸ç¼“å­˜ï¼Œæ¯æ¬¡ä»ä¸»å†…å­˜è¯»ã€‚</p>
<div class="gap"></div>
<p>åˆ†æï¼š</p>
<p>å¯„å­˜å™¨ç¼“å­˜æ˜¯ç¼–è¯‘å™¨/JITçš„ä¼˜åŒ–è¡Œä¸ºï¼Œç›®çš„æ˜¯å‡å°‘æ˜‚è´µçš„å†…å­˜è®¿é—®ã€‚</p>
<p>volatileé€šè¿‡å†…å­˜å±éšœé˜»æ­¢è¿™ç§ä¼˜åŒ–ï¼Œä¿è¯æ¯æ¬¡ä»ä¸»å†…å­˜è¯»å–ã€‚</p>
<p>é—®é¢˜ä¸åªæ˜¯å¯„å­˜å™¨ï¼Œè¿˜åŒ…æ‹¬CPUç¼“å­˜ä¸€è‡´æ€§ã€å†™ç¼“å†²åŒºç­‰ã€‚</p>
<div class="gap"></div>
<p>è®¡ç®—æœºå­˜å‚¨å±‚æ¬¡ç»“æ„ï¼š</p>
<p>CPUæ€§èƒ½ï¼šå¯„å­˜å™¨ &gt; L1ç¼“å­˜ &gt; L2ç¼“å­˜ &gt; L3ç¼“å­˜ &gt; ä¸»å†…å­˜ &gt; ç£ç›˜</p>
<p>è®¿é—®é€Ÿåº¦ï¼š0.5ns   &gt; 1ns   &gt; 3ns   &gt; 10ns   &gt; 100ns  &gt; 10ms</p>
<p>å®¹é‡å¤§å°ï¼šKBçº§åˆ«  &lt; MBçº§åˆ« &lt; MBçº§åˆ« &lt; MBçº§åˆ« &lt; GBçº§åˆ« &lt; TBçº§åˆ«</p>
<div class="gap"></div>
<p>JVMä¸ä¼šæŠŠæ•´ä¸ªå˜é‡&quot;å­˜å‚¨&quot;åœ¨å¯„å­˜å™¨é‡Œé•¿æœŸä¿å­˜ã€‚å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼š</p>
<p>// è¯¯è§£ï¼šæŠŠactiveå˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨é‡Œ</p>
<p>å¯„å­˜å™¨[active] = true;  // âŒ ä¸æ˜¯è¿™æ ·ï¼</p>
<div class="gap"></div>
<p>// å®é™…ï¼šæŠŠactiveçš„å€¼åŠ è½½åˆ°å¯„å­˜å™¨è¿›è¡Œè¿ç®—</p>
<p>boolean temp = active;  // åŠ è½½åˆ°å¯„å­˜å™¨</p>
<p>while (temp) {          // ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼</p>
<pre><code>    // å¾ªç¯ä½“</code></pre>
<p>}</p>
<p>// ä¹‹åå¯„å­˜å™¨å¯èƒ½è¢«é‡ç”¨</p>
<div class="gap"></div>
<div class="gap"></div>
<p>&quot;å¯„å­˜å™¨ç¼“å­˜&quot;çš„çœŸæ­£å«ä¹‰ï¼Œä¸æ˜¯ç‰©ç†å­˜å‚¨ï¼Œè€Œæ˜¯è®¿é—®è·¯å¾„ä¼˜åŒ–ï¼š</p>
<p>æ²¡æœ‰ä¼˜åŒ–çš„æƒ…å†µï¼ˆvolatileä¿è¯ï¼‰ï¼š</p>
<p>å¾ªç¯å¼€å§‹ â†’ è¯»å–å†…å­˜ â†’ CPUç¼“å­˜ â†’ å¯„å­˜å™¨ â†’ åˆ¤æ–­ â†’ å¾ªç¯ä½“</p>
<pre><code>      â†‘                                   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p>ä¼˜åŒ–åçš„æƒ…å†µï¼š</p>
<pre><code>      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“                                   â”‚</code></pre>
<p>å¾ªç¯å¼€å§‹ â†’ å¯„å­˜å™¨(å·²æœ‰å€¼) â†’ åˆ¤æ–­ â†’ å¾ªç¯ä½“</p>
<pre><code>      â†‘                                   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p>å…³é”®ï¼šä¼˜åŒ–åå®Œå…¨ç»•è¿‡äº†&quot;è¯»å–å†…å­˜&quot;è¿™ä¸ªæ­¥éª¤ï¼</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>PHPé»˜è®¤æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>1.4 synchronized ä¿®é¥°ç¬¦</p>
<p>synchronized å…³é”®å­—å£°æ˜çš„æ–¹æ³•åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p>
<div class="gap"></div>
<p>ä¿è¯äº†åŸå­æ€§ï¼Œé€šè¿‡ â€œäº’æ–¥é”â€ æœºåˆ¶ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ã€‚åŸå­æ€§çš„æ„æ€æ˜¯ä¸å¯åˆ†å‰²äº†ï¼Œè¯»â†’æ”¹â†’å†™ ä¸‰æ­¥æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œéƒ½è¦æ‰§è¡Œå®Œäº†æ‰é‡Šæ”¾é”ã€‚</p>
<div class="gap"></div>
<p>å®ä¾‹</p>
<pre><code>class Account {
    private int balance = 100;

    public synchronized void draw(int amount) {
        if (balance &gt; amount) {
            System.out.println(&quot;æ­£åœ¨å–é’±&quot;);
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {}
            balance -= amount;
            System.out.println(&quot;å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š&quot; + balance);
        } else {
            System.out.println(&quot;ä½™é¢ä¸è¶³ï¼Œä½™é¢ä¸ºï¼š&quot; + balance);
        }
    }
}</code></pre>
<div class="gap"></div>
<p>// æµ‹è¯•å¤šçº¿ç¨‹</p>
<pre><code>class TestSynchronized {
    public static void main(String[] args) {
        Account account = new Account();

        Runnable r1 = new Runnable() {
            @Override
            public void run() {
                account.draw(80);
            }
        };

        Thread t1 = new Thread(r1);
        Thread t2 = new Thread(r1);

        t1.start();
        t2.start();
    }
}</code></pre>
<div class="gap"></div>
<p>çº¿ç¨‹å®‰å…¨çš„è¾“å‡ºï¼š</p>
<p>æ­£åœ¨å–é’±</p>
<p>å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š20</p>
<p>ä½™é¢ä¸è¶³ï¼Œä½™é¢ä¸ºï¼š20</p>
<div class="gap"></div>
<p>å¦‚æœå»æ‰ synchronizedï¼Œåˆ™å¯èƒ½è¾“å‡ºï¼š</p>
<p>æ­£åœ¨å–é’±</p>
<p>æ­£åœ¨å–é’±</p>
<p>å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š-60</p>
<p>å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š-60</p>
<div class="gap"></div>
<p>æ­£åœ¨å–é’±</p>
<p>æ­£åœ¨å–é’±</p>
<p>å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š20</p>
<p>å–å®Œé’±ï¼Œä½™é¢ä¸ºï¼š20</p>
<div class="gap"></div>
<p>ä»£ç åˆ†æï¼šsynchronized å·²ç»ä¿è¯äº†balanceäº’æ–¥ + å¯è§æ€§ã€‚æ‰€ä»¥ä¸éœ€è¦åŠ ä¸Švolatileã€‚</p>
<p>å½“çº¿ç¨‹é€€å‡º synchronized æ–¹æ³•/å—æ—¶ï¼Œä¼šæŠŠå¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚</p>
<p>å½“å…¶ä»–çº¿ç¨‹è¿›å…¥ synchronized æ–¹æ³•/å—æ—¶ï¼Œä¼š é‡æ–°ä»ä¸»å†…å­˜è¯»å–æœ€æ–°å€¼ã€‚</p>
<div class="gap"></div>
<p>1.5 transient ä¿®é¥°ç¬¦</p>
<p>transient ä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œåœ¨å¯¹è±¡åºåˆ—åŒ–æ—¶ä¼šè¢«å¿½ç•¥ï¼Œä¸ä¼šå†™å…¥å­—èŠ‚æµã€‚ä¾‹å¦‚å¯†ç ä¸éœ€è¦æ˜¾ç¤ºå‡ºæ¥ï¼Œé‚£åºåˆ—åŒ–æ—¶ï¼Œå°±ä¸æ˜¾ç¤ºã€‚</p>
<div class="gap"></div>
<p>1.6 </p>
<p>String s1 = &quot;Runoob&quot;; ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± </p>
<p>String s4 = new String(&quot;Runoob&quot;); åœ¨å †é‡Œæ–°å»ºå¯¹è±¡ã€‚å…ˆæ£€æŸ¥å¸¸é‡æ± ï¼Œè¿™ä¸€æ­¥åŒs1ï¼Œç„¶ååœ¨å †é‡Œåˆ›å»ºä¸€ä¸ªStringå¯¹è±¡ï¼Œé‡Œé¢åˆæœ‰ä¸€ä¸ª&quot;Runoob&quot;ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>System.out.println(s1 == s4); // false</p>
<p>System.out.println(s1.equals(s4)); // true</p>
<div class="gap"></div>
<p>ä¸€èˆ¬ä¸ä½¿ç”¨new String()ï¼Œå¤šå å†…å­˜ã€æ€§èƒ½å·®ã€‚</p>
<div class="gap"></div>
<p>åŸå› ï¼š</p>
<p>== æ¯”çš„æ˜¯ å¼•ç”¨åœ°å€</p>
<p>equals() æ¯”çš„æ˜¯ å†…å®¹</p>
<div class="gap"></div>
<p>1.7</p>
<p>| å†…å­˜åŒºåŸŸ                              | å­˜å‚¨å†…å®¹                                   |</p>
<p>| --------------------------------- | -------------------------------------- |</p>
<p>| **å †ï¼ˆHeapï¼‰**                       | `new` åˆ›å»ºçš„å¯¹è±¡ã€å¯¹è±¡é‡Œçš„æˆå‘˜å˜é‡ã€æ•°ç»„ã€**å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰** |</p>
<p>| **æ ˆï¼ˆStackï¼‰**                      | å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€**åŸºæœ¬ç±»å‹å€¼**ã€å¯¹è±¡å¼•ç”¨ï¼Œä¾‹å¦‚boolean b = true; b å’Œ true éƒ½åœ¨ æ ˆ               |</p>
<p>| **è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰** | ç¼–è¯‘æœŸå¸¸é‡ã€ç¬¦å·å¼•ç”¨ï¼ˆç±»/æ–¹æ³•/å­—æ®µçš„å…ƒæ•°æ®å¼•ç”¨ï¼‰              |</p>
<p>| **å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰**                | ç±»å…ƒæ•°æ®ã€æ–¹æ³•ä¿¡æ¯ã€**é™æ€å˜é‡ï¼ˆstatic å­—æ®µï¼‰**          |</p>
<div class="gap"></div>
<div class="gap"></div>
<p>å¤§ä¾‹å­ï¼š</p>
<pre><code>public class MemoryExample {

    // ------------------- å…ƒç©ºé—´ -------------------
    // é™æ€å­—æ®µï¼Œå­˜å‚¨åœ¨å…ƒç©ºé—´
    public static int staticCounter = 0;

    // ç¼–è¯‘æœŸå¸¸é‡ï¼Œå­˜å‚¨åœ¨å…ƒç©ºé—´ + è¿è¡Œæ—¶å¸¸é‡æ± 
    public static final double PI = 3.14159;
    public static final String GREETING = &quot;Hello, JVM!&quot;;

    // ------------------- å¯¹è±¡å­—æ®µï¼ˆå †ï¼‰ -------------------
    private int instanceValue;            // æ™®é€šå¯¹è±¡å­—æ®µ â†’ å †
    private volatile boolean flag;        // volatile å¯¹è±¡å­—æ®µ â†’ å †
    private String instanceString;        // å¯¹è±¡å­—æ®µå¼•ç”¨ â†’ å †ï¼ˆå¼•ç”¨åœ¨å †ï¼ŒæŒ‡å‘ String Pool æˆ–å †ï¼‰

    public MemoryExample(String str) {
        this.instanceValue = 42;
        this.flag = true;
        this.instanceString = str; // å¯ä»¥æŒ‡å‘å¸¸é‡æ± é‡Œçš„å­—ç¬¦ä¸²
    }

    public void runExample() {
        // ------------------- æ ˆ -------------------
        int localVar = 10;                // æ ˆ
        boolean localFlag = false;        // æ ˆ
        String localString = &quot;Local String&quot;; // æ ˆé‡Œå¼•ç”¨ï¼ŒæŒ‡å‘å¸¸é‡æ± æˆ–å †

        MemoryExample localObj = new MemoryExample(&quot;Instance String&quot;); 
        // localObj å¼•ç”¨åœ¨æ ˆï¼ŒMyExample å¯¹è±¡åœ¨å †
    }

    public static void main(String[] args) {
        // æ ˆ
        MemoryExample example = new MemoryExample(GREETING); // example å¼•ç”¨åœ¨æ ˆï¼Œå¯¹è±¡åœ¨å †
        example.runExample();
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>å †(Heap)ï¼š</p>
<p>Person p = new Person();</p>
<p>int[] arr = new int[]{1, 2, 3};</p>
<p>String s = &quot;hello&quot;; // &quot;hello&quot; åœ¨ String Poolï¼ˆå †ä¸­ï¼‰</p>
<div class="gap"></div>
<p>æ ˆï¼ˆStackï¼‰ï¼š</p>
<pre><code>void test() {
    int a = 1;          // a å’Œ 1 åœ¨æ ˆ
    boolean b = true;   // b å’Œ true åœ¨æ ˆ
    Person p = new Person(); // p åœ¨æ ˆï¼ŒæŒ‡å‘å †ã€‚pé‡Œçš„æˆå‘˜å˜é‡éƒ½åœ¨å¯¹è±¡pæ‰€åœ¨çš„å †é‡Œã€‚
}</code></pre>
<div class="gap"></div>
<p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</p>
<pre><code>public class A {
    static final int X = 10; // 10 çš„å¸¸é‡ä¿¡æ¯
    void foo() {}
}</code></pre>
<p>// Aã€fooã€X ç­‰ç¬¦å·å¼•ç”¨å­˜åœ¨è¿è¡Œæ—¶å¸¸é‡æ± </p>
<div class="gap"></div>
<p>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼š</p>
<pre><code>class User {
    static int count = 0; // count å­˜åœ¨å…ƒç©ºé—´
    void login() {}
}</code></pre>
<p>// User çš„ç±»ç»“æ„ã€æ–¹æ³•è¡¨éƒ½åœ¨ Metaspace</p>
<div class="gap"></div>
<div class="gap"></div>
<p>| å†…å­˜åŒºåŸŸ                              | ä¼šä¸ä¼šè¢« GCï¼Ÿ | åŸå›  / è¯´æ˜                                                                       |</p>
<p>| --------------------------------- | -------- | ----------------------------------------------------------------------------- |</p>
<p>| **å †ï¼ˆHeapï¼‰**                       | âœ… ä¼š      | å †æ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦æˆ˜åœºã€‚**æ‰€æœ‰ `new` å‡ºæ¥çš„å¯¹è±¡**ï¼Œæ•°ç»„ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡æ± å¯¹è±¡ï¼ˆString Poolï¼‰éƒ½åœ¨å †é‡Œï¼Œ**æ— å¼•ç”¨æ—¶ GC å›æ”¶**ã€‚ |</p>
<p>| **æ ˆï¼ˆStackï¼‰**                      | âŒ ä¸ä¼š     | æ ˆæ˜¯æ–¹æ³•è°ƒç”¨çš„ä¸´æ—¶ç©ºé—´ï¼Œå±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€åŸºæœ¬ç±»å‹å€¼ã€å¯¹è±¡å¼•ç”¨éƒ½åœ¨æ ˆä¸­ï¼Œ**æ ˆå¸§å‡ºæ ˆæ—¶è‡ªåŠ¨é‡Šæ”¾**ï¼Œæ— éœ€ GCã€‚                     |</p>
<p>| **è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰** | âœ… éƒ¨åˆ†å¯å›æ”¶  | è¿è¡Œæ—¶å¸¸é‡æ± åœ¨ **ç±»å…ƒæ•°æ®é‡Œ**ï¼Œå±äºå †çš„ä¸€éƒ¨åˆ†ã€‚å¸¸é‡æ± ä¸­çš„**ç¬¦å·å¼•ç”¨æˆ–å­—é¢é‡å¸¸é‡**å¦‚æœ**æ²¡æœ‰è¢«ä»»ä½•å¼•ç”¨ä½¿ç”¨**ï¼Œå¯ä»¥è¢« GC å›æ”¶ã€‚       |</p>
<p>| **å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰**                | âœ… éƒ¨åˆ†å¯å›æ”¶  | å…ƒç©ºé—´å­˜å‚¨ç±»å…ƒæ•°æ®å’Œé™æ€å˜é‡ã€‚**ç±»è¢«å¸è½½æ—¶**ï¼Œå¯¹åº”å…ƒç©ºé—´å†…å­˜ä¼šè¢«å›æ”¶ï¼›é™æ€å˜é‡åªè¦ç±»è¿˜åœ¨ï¼Œå°±ä¸ä¼šè¢«å›æ”¶ã€‚                        |</p>
<div class="gap"></div>
<div class="gap"></div>
<p>1ï¼‰â€œåœ¨Javaåº”ç”¨ä¸­ï¼Œå †å†…å­˜é€šå¸¸æ¯”æ ˆå†…å­˜å¤§1-2ä¸ªæ•°é‡çº§â€</p>
<p>å› ä¸ºå †å­˜å‚¨æ‰€æœ‰å¯¹è±¡ï¼Œæ ˆåªå­˜å‚¨åŸºæœ¬ç±»å‹å’Œå¼•ç”¨</p>
<div class="gap"></div>
<p>2ï¼‰â€œæ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ€»æ ˆå†…å­˜ = çº¿ç¨‹æ•° Ã— æ ˆå¤§å°â€</p>
<p>çº¿ç¨‹è¿‡å¤šæ—¶ï¼Œæ ˆå†…å­˜å¯èƒ½å¾ˆå¤§</p>
<div class="gap"></div>
<p>3ï¼‰â€œå †å†…å­˜æ˜¯å…¨å±€å…±äº«çš„ï¼Œå­˜å‚¨æ‰€æœ‰å¯¹è±¡å®ä¾‹â€</p>
<p>ä¸šåŠ¡æ•°æ®ã€ç¼“å­˜éƒ½åœ¨å †ä¸­</p>
<div class="gap"></div>
<p>4ï¼‰â€œè°ƒä¼˜æ—¶ä¼˜å…ˆå…³æ³¨å †å†…å­˜ï¼Œæ ˆå†…å­˜é€šå¸¸ä¸æ˜¯ç“¶é¢ˆâ€</p>
<p>é™¤éæœ‰æ·±åº¦é€’å½’æˆ–å¤§é‡çº¿ç¨‹</p>
<div class="gap"></div>
<p>5ï¼‰â€œæ ˆæº¢å‡ºå®¹æ˜“å‘ç°ï¼ˆStackOverflowErrorï¼‰ï¼Œå †æº¢å‡ºæ›´å¸¸è§ï¼ˆOOMï¼‰â€</p>
<p>ç”Ÿäº§ç¯å¢ƒæ›´å¤šå¤„ç†å †å†…å­˜é—®é¢˜</p>
<div class="gap"></div>
<p>è®°ä½è¿™ä¸ªç»“è®ºï¼šåœ¨ç»å¤§å¤šæ•°Javaåº”ç”¨ä¸­ï¼Œå †å†…å­˜è¿œå¤§äºæ ˆå†…å­˜ã€‚æ ˆå†…å­˜é€šå¸¸åªå æ€»å†…å­˜çš„å¾ˆå°ä¸€éƒ¨åˆ†ï¼ˆ&lt;10%ï¼‰ï¼Œé™¤éåº”ç”¨åˆ›å»ºäº†å¤§é‡çº¿ç¨‹æˆ–ä½¿ç”¨äº†æ·±åº¦é€’å½’ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>1.8 String / StringBuilder / StringBuffer</p>
<p>| ç±»å‹            | é€‚ç”¨åœºæ™¯       | æ³¨æ„         |</p>
<p>| ------------- | ---------- | ---------- |</p>
<p>| String        | å°‘é‡æ‹¼æ¥ã€ä¸é¢‘ç¹ä¿®æ”¹ | æ˜“è¯»ã€ç®€å•      |</p>
<p>| StringBuilder | å¾ªç¯æ‹¼æ¥ã€åŠ¨æ€ä¿®æ”¹  | éçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½é«˜  |</p>
<p>| StringBuffer  | å¤šçº¿ç¨‹æ‹¼æ¥      | åŒæ­¥å¼€é”€å¤§ï¼Œæ€§èƒ½ç¨ä½ |</p>
<div class="gap"></div>
<p>å£è¯€ï¼š</p>
<p>å°‘é‡æ‹¼æ¥ç”¨ Stringï¼Œå¤§é‡åŠ¨æ€æ‹¼æ¥ç”¨ StringBuilderï¼›å¤šçº¿ç¨‹å…±äº«ç”¨ StringBuffer</p>
<div class="gap"></div>
<p>ä¸ºä»€ä¹ˆ StringBuilder çº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</p>
<p>StringBuilder çš„æ–¹æ³•ï¼ˆå¦‚ appendã€insertï¼‰æ²¡æœ‰åŠ  synchronized</p>
<p>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œä¼šå‡ºç° æ•°æ®ç«æ€ï¼ˆrace conditionï¼‰</p>
<p>ä¾‹å¦‚æ‹¼æ¥é”™ä¹±ã€å­—ç¬¦ä¸¢å¤±ã€æ•°ç»„è¶Šç•Œ</p>
<div class="gap"></div>
<p>StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼šå®ƒçš„å…³é”®æ–¹æ³•éƒ½åŠ äº† synchronized</p>
<div class="gap"></div>
<p>1.9 </p>
<p>æ•°ç»„ï¼š int[] array = new int[5]; å›ºå®šå¤§å°</p>
<p>åˆ—è¡¨ï¼šList&lt;String&gt; arrayList = new ArrayList&lt;&gt;(); åŠ¨æ€æ•°ç»„ï¼Œå¯å˜å¤§å°ã€‚</p>
<p>é›†åˆï¼ˆSetsï¼‰ï¼šSet&lt;String&gt; hashSet = new HashSet&lt;&gt;(); ç”¨äºå­˜å‚¨ä¸é‡å¤çš„å…ƒç´ </p>
<div class="gap"></div>
<p>HashMapï¼š</p>
<p>HashMap&lt;Integer, String&gt; employeeMap = new HashMap&lt;&gt;();</p>
<div class="gap"></div>
<p>// æ”¾å…¥æ•°æ®ï¼ˆputæ–¹æ³•ï¼‰</p>
<p>employeeMap.put(1001, &quot;å¼ ä¸‰&quot;);</p>
<p>employeeMap.put(1002, &quot;æå››&quot;);</p>
<p>employeeMap.put(1003, &quot;ç‹äº”&quot;);</p>
<p>employeeMap.put(1004, &quot;èµµå…­&quot;);</p>
<div class="gap"></div>
<p>1.10</p>
<div class="gap"></div>
<p>ä½¿ç”¨çº¿ç¨‹æ± å’ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚å¤šäººæŠ¢ç¥¨ç³»ç»Ÿã€‚</p>
<div class="gap"></div>
<pre><code>import java.util.concurrent.*;</code></pre>
<pre><code>import java.util.concurrent.atomic.AtomicInteger;</code></pre>
<div class="gap"></div>
<p>/**</p>
<p> * é«˜çº§ç‰ˆ - ä½¿ç”¨çº¿ç¨‹æ± å’ŒåŸå­æ“ä½œ</p>
<p> * æ›´é«˜æ•ˆã€æ›´ä¸“ä¸šçš„å¤šçº¿ç¨‹å®ç°</p>
<p> */</p>
<pre><code>public class ConcertTicketSystem {
    // å‰©ä½™ç¥¨æ•°ï¼ˆä½¿ç”¨åŸå­æ•´æ•°ï¼Œä¿è¯åŸå­æ€§ï¼‰
    private AtomicInteger remainingTickets = new AtomicInteger(100);
    
    // æˆåŠŸæŠ¢åˆ°ç¥¨çš„ç”¨æˆ·åˆ—è¡¨ï¼ˆçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼‰
    private ConcurrentLinkedQueue&lt;String&gt; successBuyers = new ConcurrentLinkedQueue&lt;&gt;();
    
    // å–ç¥¨æ–¹æ³• - ä½¿ç”¨åŸå­æ“ä½œ
    public boolean tryBuyTicket(String buyerName) {
        // ä½¿ç”¨åŸå­æ“ä½œçš„CASï¼ˆCompare and Swapï¼‰æœºåˆ¶
        while (true) {
            int current = remainingTickets.get();
            if (current &lt;= 0) {
                return false; // ç¥¨å·²å”®ç½„
            }
            
            // CASæ“ä½œï¼šå¦‚æœå½“å‰å€¼ä»æ˜¯currentï¼Œåˆ™å‡1
            if (remainingTickets.compareAndSet(current, current - 1)) {
                successBuyers.offer(buyerName); // è®°å½•æˆåŠŸç”¨æˆ·
                
                // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†æ—¶é—´
                try {
                    Thread.sleep(ThreadLocalRandom.current().nextInt(5, 15));
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
                
                System.out.printf(&quot;[%s] %s æˆåŠŸæŠ¢åˆ°ç¥¨ï¼Œå‰©ä½™ç¥¨æ•°: %d%n&quot;,
                        Thread.currentThread().getName(),
                        buyerName,
                        current - 1);
                return true;
            }
            // å¦‚æœCASå¤±è´¥ï¼Œè¯´æ˜è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†ï¼Œé‡è¯•
        }
    }
    
    public static void main(String[] args) throws InterruptedException {
        ConcertTicketSystem ticketSystem = new ConcertTicketSystem();
        
        System.out.println(&quot;ğŸµ çƒ­é—¨æ¼”å”±ä¼šé—¨ç¥¨å¼€å”®ï¼ ğŸµ&quot;);
        System.out.println(&quot;æ€»ç¥¨æ•°: 100 å¼ &quot;);
        System.out.println(&quot;æŠ¢ç¥¨äººæ•°: 1000 äºº&quot;);
        System.out.println(&quot;=&quot;.repeat(50));
        
        // åˆ›å»ºçº¿ç¨‹æ± ï¼ˆæœ€ä½³å®è·µï¼šä¸è¦ç›´æ¥new Threadï¼‰
        int coreCount = Runtime.getRuntime().availableProcessors();
        ExecutorService executor = Executors.newFixedThreadPool(coreCount * 2);
        
        // ä½¿ç”¨CountDownLatchæ§åˆ¶å¹¶å‘
        CountDownLatch latch = new CountDownLatch(1000);
        
        // è®°å½•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        
        // æäº¤1000ä¸ªæŠ¢ç¥¨ä»»åŠ¡
        for (int i = 1; i &lt;= 1000; i++) {
            final int userId = i;
            executor.submit(() -&gt; {
                try {
                    String buyerName = &quot;ç”¨æˆ·&quot; + userId;
                    ticketSystem.tryBuyTicket(buyerName);
                } finally {
                    latch.countDown(); // ä»»åŠ¡å®Œæˆ
                }
            });
        }
        
        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        latch.await();
        
        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
        executor.awaitTermination(1, TimeUnit.MINUTES);
        
        long endTime = System.currentTimeMillis();
        
        // æ‰“å°ç»Ÿè®¡ç»“æœ
        System.out.println(&quot;\n&quot; + &quot;=&quot;.repeat(50));
        System.out.println(&quot;ğŸ‰ æŠ¢ç¥¨ç»Ÿè®¡ç»“æœ ğŸ‰&quot;);
        System.out.println(&quot;æ€»è€—æ—¶: &quot; + (endTime - startTime) + &quot;ms&quot;);
        System.out.println(&quot;æˆåŠŸæŠ¢åˆ°ç¥¨çš„ç”¨æˆ·æ•°: &quot; + ticketSystem.successBuyers.size());
        System.out.println(&quot;å‰©ä½™ç¥¨æ•°: &quot; + ticketSystem.remainingTickets.get());
        
        // æ˜¾ç¤ºå‰10ä¸ªæŠ¢åˆ°ç¥¨çš„ç”¨æˆ·
        System.out.println(&quot;\nğŸ† å‰10ä½æŠ¢åˆ°ç¥¨çš„ç”¨æˆ·:&quot;);
        int count = 0;
        for (String buyer : ticketSystem.successBuyers) {
            if (count++ &lt; 10) {
                System.out.println(&quot;  &quot; + buyer);
            } else {
                break;
            }
        }
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<h2 id="h-2" class="heading level-1">2. å­¦ä¹  Spring Core å’Œ DI/AOP æ¦‚å¿µ</h2>
<p>â“ ä¸ºä»€ä¹ˆä¸ç”¨ newï¼Ÿ</p>
<div class="gap"></div>
<div class="gap"></div>
<p>æ–¹é¢	ä½¿ç”¨ new	ä½¿ç”¨ Spring DI	ä¼˜åŠ¿</p>
<p>åˆ›å»ºæ§åˆ¶	è‡ªå·±æ§åˆ¶	å®¹å™¨æ§åˆ¶	âœ… è§£è€¦</p>
<p>ä¾èµ–ç®¡ç†	æ‰‹åŠ¨ç®¡ç†	è‡ªåŠ¨ç®¡ç†	âœ… ç®€å•</p>
<p>å•ä¾‹æ¨¡å¼	è‡ªå·±å®ç°	è‡ªåŠ¨å•ä¾‹	âœ… ç»Ÿä¸€</p>
<p>å¾ªç¯ä¾èµ–	éš¾å¤„ç†	è‡ªåŠ¨æ£€æµ‹	âœ… å®‰å…¨</p>
<p>æµ‹è¯•	éœ€è¦Mock	è½»æ¾æ³¨å…¥Mock	âœ… å¯æµ‹è¯•</p>
<p>é…ç½®å˜æ›´	æ”¹ä»£ç 	æ”¹é…ç½®	âœ… çµæ´»</p>
<div class="gap"></div>
<div class="gap"></div>
<p>å¯åŠ¨æ—¶é—´ vs è¿è¡Œæ—¶é—´</p>
<p>ä½¿ç”¨ newï¼š</p>
<p>âœ… å¯åŠ¨å¿«ï¼šç›´æ¥åˆ›å»º</p>
<p>âŒ è¿è¡Œæ…¢ï¼šæ¯æ¬¡éƒ½è¦åˆ›å»ºå’Œè¿æ¥</p>
<div class="gap"></div>
<p>ä½¿ç”¨ Spring DIï¼š</p>
<p>âŒ å¯åŠ¨æ…¢ï¼šéœ€è¦æ‰«æã€åˆ†æã€åˆ›å»ºæ‰€æœ‰Bean</p>
<p>âœ… è¿è¡Œå¿«ï¼šBeanæ˜¯å•ä¾‹ï¼Œå¤ç”¨å·²åˆ›å»ºçš„å¯¹è±¡</p>
<div class="gap"></div>
<p>å¯¹äºé•¿æœŸè¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚WebæœåŠ¡å™¨ï¼‰ï¼š</p>
<p>å¯åŠ¨æ—¶é—´å½±å“ä¸å¤§ï¼Œè¿è¡Œæ•ˆç‡æ›´é‡è¦ï¼</p>
<div class="gap"></div>
<p>â“ å¯¹è±¡æ˜¯è°åˆ›å»ºçš„ï¼Ÿ</p>
<p>å¯¹è±¡æ˜¯ç”± Spring IoCï¼ˆæ§åˆ¶åè½¬ï¼‰å®¹å™¨åˆ›å»ºçš„ã€‚</p>
<div class="gap"></div>
<p>â“ Spring å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Springå®¹å™¨ï¼ˆIoCå®¹å™¨ï¼‰æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒå¼•æ“ï¼Œå®ƒçš„æ­£å¼åç§°æ˜¯ ApplicationContextï¼ˆåº”ç”¨ä¸Šä¸‹æ–‡ï¼‰ã€‚</p>
<div class="gap"></div>
<p>åˆ›å»ºå¹¶ç®¡ç†æ‰€æœ‰ç”±å®ƒæ‰˜ç®¡çš„Javaå¯¹è±¡ï¼ˆè¿™äº›å¯¹è±¡è¢«ç§°ä¸º Beanï¼‰ã€‚</p>
<p>è®°ä½ï¼šåœ¨ Spring çš„ä¸–ç•Œé‡Œï¼Œå‡ ä¹ä¸€åˆ‡å¯¹è±¡éƒ½æ˜¯ Beanï¼</p>
<div class="gap"></div>
<p>æœ¬è´¨ä¸€å¥è¯ï¼š</p>
<p>Spring å¸®ä½ ç®¡ç†å¯¹è±¡çš„åˆ›å»ºã€ä¾èµ–å…³ç³»å’Œç”Ÿå‘½å‘¨æœŸ</p>
<div class="gap"></div>
<h2 id="h-3" class="heading level-1">3. å®è·µ Spring MVC å¼€å‘ Web åº”ç”¨</h2>
<p>3.1 è¦å­¦ä¹  Java 1.8ï¼ˆJava 8ï¼‰+ Spring Boot 2.7.6ï¼Œå®˜æ–¹å·²ç»ä¸æ¨èäº†ã€‚æ‰€ä»¥è¦æ‰‹åŠ¨åœ¨ https://start.aliyun.com/ è¿›è¡Œä¸‹è½½ Srping Boot 2.7.6ã€‚</p>
<div class="gap"></div>
<p>â‘  åŠ  JPA + MySQL ä¾èµ–</p>
<p>â‘¡ é…ç½®æ•°æ®æº</p>
<p>â‘¢ å†™ UserEntity</p>
<p>â‘£ å†™ UserRepository</p>
<p>â‘¤ å†™ UserService</p>
<p>â‘¥ Controller è°ƒæ¥å£</p>
<div class="gap"></div>
<div class="gap"></div>
<h2 id="h-4" class="heading level-1">4. å­¦ä¹  Spring Data è¿›è¡Œæ•°æ®åº“æ“ä½œ</h2>
<div class="gap"></div>
<h2 id="h-5" class="heading level-1">5. æŒæ¡ Spring Boot ç®€åŒ–å¼€å‘æµç¨‹</h2>
<p>Spring Boot æ˜¯ Spring æ¡†æ¶çš„æ‰©å±•ï¼Œæ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„åˆå§‹æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ã€‚</p>
<div class="gap"></div>
<p>Spring Boot ä¸»è¦ç‰¹æ€§ï¼š</p>
<div class="gap"></div>
<p>è‡ªåŠ¨é…ç½®ï¼šæ ¹æ®ç±»è·¯å¾„ä¸­çš„ jar åŒ…è‡ªåŠ¨é…ç½® Spring åº”ç”¨</p>
<p>èµ·æ­¥ä¾èµ–ï¼šç®€åŒ–ä¾èµ–ç®¡ç†</p>
<p>å†…åµŒæœåŠ¡å™¨ï¼šæ— éœ€éƒ¨ç½² WAR æ–‡ä»¶</p>
<p>Actuatorï¼šæä¾›ç”Ÿäº§çº§ç›‘æ§åŠŸèƒ½</p>
<div class="gap"></div>
<h2 id="h-6" class="heading level-1">6. æ¢ç´¢ Spring Cloud æ„å»ºå¾®æœåŠ¡</h2>
<p>6.1 Spring Cloud vs Spring Boot</p>
<p>Spring Bootï¼šç®€åŒ–å•ä¸ªåº”ç”¨çš„å¼€å‘</p>
<p>Spring Cloudï¼šæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿ/å¾®æœåŠ¡æ¶æ„ï¼Œå…³æ³¨å¦‚ä½•è¿æ¥å’Œç®¡ç†å¤šä¸ªSpring Bootåº”ç”¨</p>
<div class="gap"></div>
<p>1ã€ **å…ˆæŒæ¡ Spring Boot**ï¼ˆå¿…é¡»ï¼‰</p>
<p>   - è‡ªåŠ¨é…ç½®åŸç†</p>
<p>   - Starteræœºåˆ¶</p>
<p>   - REST APIå¼€å‘</p>
<p>   - æ•°æ®è®¿é—®ï¼ˆJPA/MyBatisï¼‰</p>
<p>   - äº‹åŠ¡ç®¡ç†</p>
<div class="gap"></div>
<p>2ã€ **å†å­¦ä¹  Spring Cloud**ï¼ˆéœ€è¦æ—¶ï¼‰</p>
<p>   - å…ˆç†è§£å¾®æœåŠ¡æ¦‚å¿µ</p>
<p>   - ä»æœåŠ¡æ³¨å†Œå‘ç°å¼€å§‹ï¼ˆEureka/Nacosï¼‰</p>
<p>   - å­¦ä¹ æœåŠ¡é—´é€šä¿¡ï¼ˆFeign/RestTemplateï¼‰</p>
<p>   - æŒæ¡é…ç½®ä¸­å¿ƒï¼ˆConfig/Nacosï¼‰</p>
<p>   - äº†è§£ç†”æ–­é™æµï¼ˆHystrix/Sentinelï¼‰</p>
<div class="gap"></div>
<div class="gap"></div>
<p>// é—®ï¼šæˆ‘åº”è¯¥ç›´æ¥å­¦Spring Cloudå—ï¼Ÿ</p>
<p>// ç­”ï¼šä¸å»ºè®®ï¼åº”è¯¥ï¼š</p>
<div class="gap"></div>
<p>// é˜¶æ®µ1ï¼šæŒæ¡å•ä½“åº”ç”¨å¼€å‘ï¼ˆSpring Bootè¶³å¤Ÿï¼‰</p>
<pre><code>@SpringBootApplication</code></pre>
<pre><code>public class MonolithApplication {
    // ç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†éƒ½åœ¨ä¸€ä¸ªåº”ç”¨é‡Œ
    // ä½¿ç”¨Spring MVC + Spring Data + Spring Security
}</code></pre>
<div class="gap"></div>
<p>// é˜¶æ®µ2ï¼šå­¦ä¹ å¾®æœåŠ¡æ‹†åˆ†ï¼ˆéœ€è¦Spring Cloudï¼‰</p>
<p>// æŠŠä¸Šé¢çš„å•ä½“æ‹†åˆ†ä¸ºï¼š</p>
<p>// 1. user-serviceï¼ˆç”¨æˆ·æœåŠ¡ï¼‰</p>
<p>// 2. order-serviceï¼ˆè®¢å•æœåŠ¡ï¼‰</p>
<p>// 3. product-serviceï¼ˆå•†å“æœåŠ¡ï¼‰</p>
<p>// 4. ç”¨Spring CloudæŠŠå®ƒä»¬è¿æ¥èµ·æ¥</p>
<div class="gap"></div>
<div class="gap"></div>
<p>-------------------------------</p>
<p>-------------------------------</p>
<p>-------------------------------</p>
<p>-------------------------------</p>
<p>-------------------------------</p>
<p>-------------------------------</p>
<p>7. ç»ƒæ‰‹</p>
<p>è·³æ§½ç”¨æœ€å°é¡¹ç›®ï¼ˆå¿…åšï¼‰</p>
<div class="gap"></div>
<p>â— ä¸åšé¡¹ç›® = å¾ˆéš¾è¯´æœé¢è¯•å®˜</p>
<div class="gap"></div>
<p>é¡¹ç›®ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰</p>
<div class="gap"></div>
<p>ä¸€ä¸ªå¸¦ JWT ç™»å½•çš„ Spring Boot API æœåŠ¡</p>
<div class="gap"></div>
<p>é¡¹ç›®åŠŸèƒ½ï¼ˆåˆšåˆšå¥½ï¼Œä¸å¤šï¼‰</p>
<p>POST   /api/auth/login</p>
<p>GET    /api/users</p>
<p>GET    /api/users/{id}</p>
<p>POST   /api/users</p>
<p>PUT    /api/users/{id}</p>
<p>DELETE /api/users/{id}</p>
<div class="gap"></div>
<p>æŠ€æœ¯ç‚¹ï¼ˆå…¨æ˜¯é¢è¯•ç‚¹ï¼‰</p>
<div class="gap"></div>
<p>Java 17</p>
<p>1ï¼‰Sealed Classesï¼ˆå¯†å°ç±»ï¼‰ï¼šé™åˆ¶å“ªäº›ç±»å¯ä»¥é›†æˆï¼Œå¢å¼ºä»£ç å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§</p>
<p>2ï¼‰Recordsï¼ˆè®°å½•ç±»ï¼‰ï¼šè‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°ã€getterï¼Œç±»ä¼¼ Lombok @Dataã€‚è§£å†³æ ·æ¿ä»£ç å¤šçš„é—®é¢˜ã€‚</p>
<p>3ï¼‰Switchè¡¨è¾¾å¼ï¼šè§£å†³Switchè¯­å¥å†—é•¿</p>
<p>4ï¼‰Text Blocksï¼ˆæ–‡æœ¬å—ï¼‰- JEP 378</p>
<p>java</p>
<p>// é¢è¯•é—®é¢˜ï¼šText Blocks è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>// æ—§æ–¹å¼ï¼šå¤šè¡Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸‘</p>
<p>String json = &quot;{\n&quot; +</p>
<pre><code>              &quot;  \&quot;name\&quot;: \&quot;å¼ ä¸‰\&quot;,\n&quot; +
              &quot;  \&quot;age\&quot;: 25\n&quot; +
              &quot;}&quot;;</code></pre>
<p>// Java 17 æ–¹å¼ï¼šä¸‰å¼•å·æ–‡æœ¬å—</p>
<p>String json = &quot;&quot;&quot;</p>
<pre><code>    {
      &quot;name&quot;: &quot;å¼ ä¸‰&quot;,
      &quot;age&quot;: 25
    }</code></pre>
<pre><code>    &quot;&quot;&quot;;</code></pre>
<p>Spring Boot</p>
<div class="gap"></div>
<p>Spring Data JPA æˆ– MyBatis</p>
<div class="gap"></div>
<p>JWTï¼ˆæ‹¦æˆªå™¨å®ç°ï¼‰</p>
<div class="gap"></div>
<p>AOP æ—¥å¿—</p>
<p>Spring Boot 2 æœ€å¸¸ç”¨çš„æ—¥å¿—æ–¹æ¡ˆï¼Œæœ€å¸¸ç”¨ç»„åˆï¼šSLF4J + Logbackï¼Œå¦å¤–å†åŠ ä¸ŠLombok ä¾èµ–/æ³¨è§£</p>
<div class="gap"></div>
<p>SLF4J (Simple Logging Facade for Java)</p>
<div class="gap"></div>
<p>æ¦‚å¿µ	ç±»æ¯”	è¯´æ˜</p>
<p>SLF4J	Java çš„ JDBC æ¥å£	å®šä¹‰äº†ä¸€ç»„æ ‡å‡†æ¥å£ï¼Œä½†ä¸å®ç°</p>
<p>Logback	MySQL JDBC é©±åŠ¨	å…·ä½“çš„å®ç°ï¼ŒçœŸæ­£å¹²æ´»çš„éƒ¨åˆ†</p>
<p>å…³ç³»	USB æ¥å£ vs USB è®¾å¤‡	SLF4J æ˜¯æ¥å£è§„èŒƒï¼ŒLogback æ˜¯å…·ä½“è®¾å¤‡</p>
<div class="gap"></div>
<p>å¦å¤–å¯ä»¥åŠ ä¸Šæ·»åŠ  Lombok ä¾èµ–ï¼ˆæœ€å¸¸ç”¨ï¼‰</p>
<p>&lt;!-- Lombokï¼šæ³¨è§£è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œå¦‚@Getterã€@Setterã€@Slf4jã€@Builder --&gt;</p>
<p>&lt;dependency&gt;</p>
<pre><code>    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.30&lt;/version&gt; &lt;!-- ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ --&gt;
    &lt;scope&gt;provided&lt;/scope&gt;</code></pre>
<p>&lt;/dependency&gt;</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>------------------------------</p>
<p>------------------------------</p>
<p>Controllerçš„åˆ‡é¢ä¾‹å­ï¼Œç”¨æ¥è®°å½•requestå’Œresponseã€è€—æ—¶ï¼š</p>
<div class="gap"></div>
<pre><code>package com.muwen.demoapi.web.aspect;</code></pre>
<div class="gap"></div>
<pre><code>import com.fasterxml.jackson.core.JsonProcessingException;</code></pre>
<pre><code>import com.fasterxml.jackson.databind.ObjectMapper;</code></pre>
<pre><code>import lombok.extern.slf4j.Slf4j;</code></pre>
<pre><code>import org.aspectj.lang.JoinPoint;</code></pre>
<pre><code>import org.aspectj.lang.ProceedingJoinPoint;</code></pre>
<pre><code>import org.aspectj.lang.annotation.*;</code></pre>
<pre><code>import org.springframework.stereotype.Component;</code></pre>
<div class="gap"></div>
<pre><code>@Slf4j // ç›¸å½“äº private static final Logger log = LoggerFactory.getLogger(WebLogAspect.class);</code></pre>
<pre><code>@Aspect // å‘Šè¯‰ Spring è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»ï¼ŒåŒ…å«åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰å’Œé€šçŸ¥ï¼ˆAdviceï¼‰ã€‚æ²¡æœ‰ @Aspectï¼Œåˆ™@Pointcutã€@Beforeã€@Around ç­‰æ³¨è§£æ— æ•ˆ</code></pre>
<pre><code>@Component // è®© Spring æ‰«æåˆ°è¯¥ç±»å¹¶æ³¨å†Œä¸º Beanï¼Œè®© Spring å®¹å™¨åˆ›å»ºå’Œç®¡ç†è¯¥ç±»çš„å®ä¾‹</code></pre>
<pre><code>public class WebLogAspect {
    private final ObjectMapper objectMapper;

    public WebLogAspect(ObjectMapper objectMapper) {
        this.objectMapper = objectMapper;
    }

    @Pointcut(&quot;execution(public * com.muwen.demoapi.web.controller..*(..))&quot;)
    public void webLogPointcut() {}

    /**
     * å‰ç½®é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ
     *
     * @param joinPoint åˆ‡ç‚¹
     */
    @Before(&quot;webLogPointcut()&quot;)
    public void doBefore(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().toShortString();
        Object[] args = joinPoint.getArgs();
        log.info(&quot;è¯·æ±‚æ–¹æ³•: {}, å‚æ•°: {}&quot;, methodName, args);
    }

    /**
     * ç¯ç»•é€šçŸ¥ï¼šç¯ç»•ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
     *
     * @param proceedingJoinPoint åˆ‡ç‚¹
     * @return ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
     * @throws Throwable å¦‚æœç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸
     */
    @Around(&quot;webLogPointcut()&quot;)
    public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();

        Object result = proceedingJoinPoint.proceed();

        // è¾“å‡ºæ‰§è¡Œæ—¶é—´
        log.info(&quot;Time Consuming: {} ms&quot;, System.currentTimeMillis() - startTime);

        return result;
    }

    /**
     * åç½®é€šçŸ¥ï¼šåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ
     *
     * @param result ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
     */
    @AfterReturning(pointcut = &quot;webLogPointcut()&quot;, returning = &quot;result&quot;)
    public void doAfterReturning(Object result) {
        try {
            String responseBody = objectMapper.writeValueAsString(result);
            log.info(&quot;å“åº”ç»“æœ: {}&quot;, responseBody);
        } catch (JsonProcessingException e) {
            log.warn(&quot;å“åº”ç»“æœåºåˆ—åŒ–å¤±è´¥&quot;, e);
            log.info(&quot;å“åº”ç»“æœ: {}&quot;, result);
        }
    }


}</code></pre>
<div class="gap"></div>
<p>------------------------------</p>
<p>------------------------------</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>äº‹åŠ¡</p>
<div class="gap"></div>
<p>Dockerï¼ˆåŠ åˆ†ï¼‰</p>
<div class="gap"></div>
<p>ğŸ‘‰ è¿™ä¸ªé¡¹ç›® = é¢è¯•å¼¹è¯åº“</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>ä¸­å›½ Java é¢è¯•é«˜é¢‘å…«è‚¡ï¼ˆåªèƒŒè¿™äº›ï¼‰</p>
<p>ğŸ”¥ å¿…ä¼š</p>
<div class="gap"></div>
<p>Spring IoC / DI</p>
<div class="gap"></div>
<p>AOP åŸç†</p>
<p>ä¸€å¥è¯æ¦‚æ‹¬ï¼šSpring AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œç”¨äºå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ï¼‰æ¨¡å—åŒ–ï¼Œå¹¶ä»¥éä¾µå…¥æ–¹å¼ç»‡å…¥åˆ°ç›®æ ‡æ–¹æ³•çš„æ¡†æ¶ã€‚</p>
<div class="gap"></div>
<p>1ï¼‰Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>Spring AOP æ˜¯è¿è¡Œæ—¶åŠ¨æ€ä»£ç†ï¼Œä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„ç»‡å…¥ã€‚</p>
<p>AspectJ æ˜¯ç¼–è¯‘æ—¶/ç±»åŠ è½½ç»‡å…¥ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼ˆå¯ç»‡å…¥å­—æ®µã€æ„é€ å™¨ç­‰ï¼‰ï¼Œä½†æ›´å¤æ‚ã€‚</p>
<div class="gap"></div>
<p>Spring AOPæ˜¯AspectJçš„ä¸€ä¸ªåŠŸèƒ½å­é›†ã€‚</p>
<div class="gap"></div>
<p>2ï¼‰é€šçŸ¥çš„é¡ºåºï¼š</p>
<pre><code>@Around å¼€å§‹ï¼ˆproceed() ä¹‹å‰çš„éƒ¨åˆ†ï¼‰</code></pre>
<pre><code>@Before</code></pre>
<p>proceed()ç›®æ ‡æ–¹æ³•æ‰§è¡Œ</p>
<pre><code>@Around ç»§ç»­ï¼ˆproceed() ä¹‹åçš„éƒ¨åˆ†ï¼‰</code></pre>
<pre><code>@AfterReturningï¼ˆæˆåŠŸï¼‰æˆ– @AfterThrowingï¼ˆå¼‚å¸¸ï¼‰</code></pre>
<pre><code>@Afterï¼ˆæœ€ç»ˆé€šçŸ¥ï¼Œç±»ä¼¼ finallyï¼‰</code></pre>
<div class="gap"></div>
<p>3ï¼‰Spring AOP é»˜è®¤ä½¿ç”¨å“ªç§åŠ¨æ€ä»£ç†ï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨ CGLIBï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç›®æ ‡ç±»å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼ŒSpring AOP ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼ˆåŸºäº InvocationHandlerï¼‰ï¼›å¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™ä½¿ç”¨ CGLIB ç”Ÿæˆå­ç±»ä»£ç†ã€‚åœ¨ Spring Boot 2.x åï¼Œå¯ä»¥é€šè¿‡ spring.aop.proxy-target-class=true å¼ºåˆ¶ä½¿ç”¨ CGLIBã€‚</p>
<div class="gap"></div>
<p>JDKåŠ¨æ€ä»£ç†åŸºäºæ¥å£ï¼Œåˆ©ç”¨åå°„æœºåˆ¶ï¼›CGLIBåŸºäºç»§æ‰¿ï¼Œé€šè¿‡å­—èŠ‚ç ç”Ÿæˆå­ç±»ã€‚</p>
<div class="gap"></div>
<p>4ï¼‰å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„æ³¨è§£ï¼Œå¹¶åˆ©ç”¨ AOP ä½¿å…¶ç”Ÿæ•ˆï¼Ÿ</p>
<p>å®šä¹‰æ³¨è§£ @MyLogã€‚</p>
<p>åˆ›å»ºåˆ‡é¢ç±»ï¼Œç”¨ @Aspect å’Œ @Component æ ‡æ³¨ã€‚</p>
<p>åœ¨é€šçŸ¥æ³¨è§£ï¼ˆå¦‚ @Aroundï¼‰ä¸­ï¼Œä½¿ç”¨ @annotation(myLog) ç»‘å®šè‡ªå®šä¹‰æ³¨è§£ã€‚</p>
<p>åœ¨é€šçŸ¥æ–¹æ³•ä¸­ç¼–å†™å¢å¼ºé€»è¾‘ã€‚</p>
<div class="gap"></div>
<p>5ï¼‰åœ¨å¾®æœåŠ¡ä¸­ï¼ŒAOP å¯ä»¥åº”ç”¨äºå“ªäº›åœºæ™¯ï¼Ÿ</p>
<p>å…¨å±€å¼‚å¸¸å¤„ç†ï¼š@ControllerAdvice æœ¬èº«å°±æ˜¯ AOP æ€æƒ³çš„ä½“ç°ã€‚</p>
<p>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼šåœ¨åˆ‡é¢ä¸­å‘è¯·æ±‚å¤´æ³¨å…¥æˆ–æå– TraceIdã€‚</p>
<p>æ¥å£é™æµä¸ç†”æ–­ï¼šé€šè¿‡è‡ªå®šä¹‰æ³¨è§£å’Œ AOP ç»Ÿä¸€å®ç°ã€‚</p>
<p>Feign å®¢æˆ·ç«¯å¢å¼ºï¼šç»Ÿä¸€æ·»åŠ è®¤è¯å¤´ã€è®°å½•æ—¥å¿—ã€‚</p>
<div class="gap"></div>
<p>6ï¼‰AOP å¯¹æ€§èƒ½æœ‰å½±å“å—ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</p>
<p>å½±å“ï¼šåŠ¨æ€ä»£ç†ä¼šå¸¦æ¥å¾®å°çš„æ€§èƒ½å¼€é”€ï¼ˆæ–¹æ³•è°ƒç”¨è½¬å‘ï¼‰ã€‚</p>
<div class="gap"></div>
<p>ä¼˜åŒ–ï¼šç²¾ç¡®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆé¿å…è¿‡äºå®½æ³›çš„ execution(* com..*.*(..))ï¼‰ï¼Œåœ¨éå¿…è¦çš„åœ°æ–¹é¿å…ä½¿ç”¨ AOPï¼Œå¯¹äºæ€§èƒ½æåº¦æ•æ„Ÿçš„åœºæ™¯å¯ä»¥è€ƒè™‘ AspectJ ç¼–è¯‘æ—¶ç»‡å…¥ã€‚</p>
<div class="gap"></div>
<p>7ï¼‰ä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ AOP è§£å†³å®é™…é—®é¢˜çš„ï¼Ÿ</p>
<p>æˆ‘åœ¨XXé¡¹ç›®ä¸­ï¼Œåˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£ @OperationLog å’Œ AOP å®ç°äº†æ“ä½œæ—¥å¿—çš„ç»Ÿä¸€è®°å½•ã€‚åˆ‡é¢ä¼šæ‹¦æˆªæ‰€æœ‰å¸¦è¯¥æ³¨è§£çš„æ–¹æ³•ï¼Œè‡ªåŠ¨å°†æ“ä½œäººã€æ—¶é—´ã€å‚æ•°å’Œç»“æœå¼‚æ­¥å­˜å…¥æ•°æ®åº“ã€‚è¿™ä½¿ä¸šåŠ¡ä»£ç éå¸¸å¹²å‡€ï¼Œå¹¶ä¸”ä¾¿äºåç»­çš„å®¡è®¡å’Œæ’æŸ¥é—®é¢˜ã€‚</p>
<pre><code></code></pre>
<pre><code>@Transactional å¤±æ•ˆåœºæ™¯</code></pre>
<p>1ï¼‰æ–¹æ³•è®¿é—®æƒé™é—®é¢˜</p>
<pre><code>    // âœ… æ­£ç¡®ï¼špublicæ–¹æ³•
    @Transactional
    public void createUserPublic(User user) {
        userRepository.save(user);
    }</code></pre>
<p>2ï¼‰è‡ªè°ƒç”¨é—®é¢˜</p>
<pre><code>@Service</code></pre>
<pre><code>public class OrderService {
    
    public void createOrder(Order order) {
        // âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨åŒç±»ä¸­çš„äº‹åŠ¡æ–¹æ³•
        this.updateInventory(order);  // äº‹åŠ¡å¤±æ•ˆï¼
        orderRepository.save(order);
    }
    
    @Transactional
    public void updateInventory(Order order) {
        inventoryService.reduce(order.getProductId(), order.getQuantity());
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code>@Service</code></pre>
<pre><code>public class OrderService {
    
    // âœ… æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªèº«ä»£ç†
    @Autowired
    private OrderService self;  // Springä¼šæ³¨å…¥ä»£ç†å¯¹è±¡
    
    public void createOrder(Order order) {
        self.updateInventory(order);  // âœ… é€šè¿‡ä»£ç†è°ƒç”¨
        orderRepository.save(order);
    }
    
    @Transactional
    public void updateInventory(Order order) {
        inventoryService.reduce(order.getProductId(), order.getQuantity());
    }
}</code></pre>
<div class="gap"></div>
<p>ä½ æ³¨å…¥çš„ä¸æ˜¯â€œè‡ªå·±â€ï¼Œè€Œæ˜¯â€œè‡ªå·±çš„ä»£ç†â€ã€‚</p>
<p>AOPï¼ˆäº‹åŠ¡ï¼‰çš„é€»è¾‘æ˜¯ç”±ä»£ç†å¯¹è±¡æ‰§è¡Œçš„ã€‚</p>
<div class="gap"></div>
<p>3ï¼‰å¼‚å¸¸ç±»å‹æ•è·é—®é¢˜</p>
<pre><code>@Service</code></pre>
<pre><code>public class PaymentService {
    
    @Transactional
    public void processPayment(Payment payment) {
        try {
            paymentRepository.save(payment);
            throw new RuntimeException(&quot;ä¸šåŠ¡å¼‚å¸¸&quot;);
        } catch (Exception e) {
            // âŒ æ•è·äº†å¼‚å¸¸ï¼Œäº‹åŠ¡ä¸ä¼šå›æ»š
            log.error(&quot;æ”¯ä»˜å¤±è´¥&quot;, e);
        }
    }
    
    @Transactional
    public void processPayment2(Payment payment) {
        try {
            paymentRepository.save(payment);
            throw new Exception(&quot;å—æ£€å¼‚å¸¸&quot;);
        } catch (Exception e) {
            // âŒ RuntimeExceptionæ‰ä¼šé»˜è®¤å›æ»šï¼Œå—æ£€å¼‚å¸¸ä¸ä¼š
            log.error(&quot;æ”¯ä»˜å¤±è´¥&quot;, e);
        }
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>ä¸€ä¸ªäº‹åŠ¡ä¾‹å­ï¼š</p>
<pre><code>@Service</code></pre>
<pre><code>public class PaymentService {
    
    @Transactional
    public void processPayment(PaymentRequest request) {
        // 1. ä¿å­˜æ”¯ä»˜è®°å½•ï¼ˆINSERTæ“ä½œï¼‰
        paymentRepository.save(request.toPayment());
        
        // 2. ä¸šåŠ¡é€»è¾‘å¯èƒ½æŠ›å‡ºå„ç§å¼‚å¸¸
        if (request.isInvalid()) {
            throw new IllegalArgumentException(&quot;éæ³•è¯·æ±‚&quot;); // âœ… RuntimeExceptionï¼Œè§¦å‘å›æ»š
        }
        
        try {
            thirdPartyService.call(); // å¯èƒ½æŠ›å‡ºIOExceptionï¼ˆéRuntimeExceptionï¼‰
        } catch (IOException e) {
            // âŒ é»˜è®¤ä¸ä¼šå›æ»šï¼æ”¯ä»˜è®°å½•å·²ä¿å­˜ï¼
            throw new RuntimeException(&quot;è°ƒç”¨å¤±è´¥&quot;, e); // åŒ…è£…ä¸ºRuntimeExceptionï¼Œè§¦å‘å›æ»š
        }
        
        // 3. æ‰‹åŠ¨æ§åˆ¶å›æ»š
        if (paymentFailed) {
            TransactionAspectSupport.currentTransactionStatus().setRollbackOnly(); // æ ‡è®°å›æ»š
            // æˆ–è€…ï¼Œç›´æ¥æŠ›å‡ºç‰¹å®šå¼‚å¸¸ï¼š
            throw new CustomBusinessException(&quot;ä¸šåŠ¡å¤±è´¥ï¼Œå·²å›æ»š&quot;);
        }
    }
}</code></pre>
<div class="gap"></div>
<p>äº‹åŠ¡å¼‚å¸¸ï¼Œä¼šæŠ›å‡º RuntimeExceptionï¼Œä¾‹å¦‚ DataIntegrityViolationExceptionï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<p>[æ•°æ®åº“æ“ä½œå¤±è´¥ / ä¸šåŠ¡è§„åˆ™è¿ä¾‹]</p>
<pre><code>         â†“ (æŠ›å‡º RuntimeExceptionï¼Œä¾‹å¦‚ DataIntegrityViolationException)</code></pre>
<p>[Serviceå±‚ @Transactional æ–¹æ³•] â†’ äº‹åŠ¡å›æ»š</p>
<pre><code>         â†“ (å¼‚å¸¸ç»§ç»­å‘ä¸ŠæŠ›å‡º)</code></pre>
<p>[Controllerå±‚æ–¹æ³•]</p>
<pre><code>         â†“</code></pre>
<p>[å¼€å‘è€…/å‰ç«¯çœ‹åˆ°çš„ç»“æœ] â† å–å†³äºï¼š1. æ˜¯å¦å¤„ç†å¼‚å¸¸ 2. å¦‚ä½•å¤„ç†</p>
<div class="gap"></div>
<div class="gap"></div>
<pre><code>@Transactional æ˜¯ AOPï¼Œæ˜¯å› ä¸ºå®ƒå®Œå…¨éµå¾ª AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„æ ¸å¿ƒæ€æƒ³å’Œå·¥ä½œåŸç†ï¼šé€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰ ä»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶ä»¥éä¾µå…¥çš„æ–¹å¼åŠ¨æ€ç»‡å…¥ã€‚</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>HashMap åŸç†</p>
<p>é—®é¢˜1ï¼šHashMapçš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Java 8+ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</p>
<div class="gap"></div>
<p>å…³é”®å‚æ•°ï¼š</p>
<p>é»˜è®¤åˆå§‹å®¹é‡ï¼š16</p>
<p>è´Ÿè½½å› å­ï¼š0.75</p>
<p>æ ‘åŒ–é˜ˆå€¼ï¼šé“¾è¡¨é•¿åº¦â‰¥8 ä¸” æ•°ç»„é•¿åº¦â‰¥64æ—¶ï¼Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘</p>
<p>é€€åŒ–é˜ˆå€¼ï¼šæ ‘èŠ‚ç‚¹â‰¤6ï¼Œçº¢é»‘æ ‘é€€åŒ–ä¸ºé“¾è¡¨</p>
<div class="gap"></div>
<p>æ˜¯çš„ï¼Œæ‚¨è¯´å¾—å¯¹ã€‚åœ¨æ­£å¸¸çš„ä¸šåŠ¡æ•°æ®å’Œè‰¯å¥½çš„å“ˆå¸Œå‡½æ•°ä¸‹ï¼ŒHashMapå‡ ä¹ä¸ä¼šè§¦å‘çº¢é»‘æ ‘è½¬æ¢ï¼Œæ ¹æ®æ³Šæ¾åˆ†å¸ƒï¼Œé“¾è¡¨é•¿åº¦è¾¾åˆ°8çš„æ¦‚ç‡åªæœ‰çº¦ä¸€äº¿åˆ†ä¹‹å…­ã€‚</p>
<div class="gap"></div>
<p>ä½†JDKå¼•å…¥çº¢é»‘æ ‘æœºåˆ¶ä¸»è¦æ˜¯ä¸€ç§é˜²å¾¡æ€§ç¼–ç¨‹ç­–ç•¥ï¼Œæ ¸å¿ƒç›®çš„æ˜¯ï¼š</p>
<div class="gap"></div>
<p>é˜²æ­¢å“ˆå¸Œç¢°æ’æ”»å‡»ï¼šç¡®ä¿å³ä½¿é­é‡æ¶æ„æ”»å‡»ï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šä»O(1)æ¶åŒ–ä¸ºO(n)ï¼Œè€Œæ˜¯ç»´æŒåœ¨O(log n)ã€‚</p>
<div class="gap"></div>
<p>ä¸ºåŠ£è´¨hashCodeå…œåº•ï¼šå¯¹å¼€å‘è€…ä¸è§„èŒƒçš„hashCode()å®ç°æä¾›ä¸€å®šçš„æ€§èƒ½ä¿éšœã€‚</p>
<div class="gap"></div>
<p>æ‰€ä»¥ï¼Œè™½ç„¶å®ƒæ˜¯ä¸€ä¸ªâ€˜å¤‡èƒâ€™ï¼Œä½†å´æ˜¯ä¿éšœHashMapåœ¨æç«¯æƒ…å†µä¸‹ä»èƒ½ä¿æŒå¯ç”¨æ€§çš„å…³é”®å®‰å…¨ç½‘ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œç¡®ä¿ä½œä¸ºKeyçš„å¯¹è±¡æ­£ç¡®å®ç°hashCode()å’Œequals()æ–¹æ³•ï¼Œå°±æ˜¯é¿å…è§¦å‘è¿™ä¸ªâ€˜å¤‡èƒæœºåˆ¶â€™çš„æœ€ä½³å®è·µã€‚</p>
<div class="gap"></div>
<p>Q1ï¼šHashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</p>
<p>å›ç­”è¦ç‚¹ï¼š</p>
<p>1ï¼‰å¤šçº¿ç¨‹æ‰©å®¹æ—¶å¯èƒ½å½¢æˆå¾ªç¯é“¾è¡¨ï¼ˆJDK 1.7åŠä¹‹å‰ï¼‰ï¼Œå¯¼è‡´CPU 100%ã€‚</p>
<p>2ï¼‰å¤šçº¿ç¨‹putå¯èƒ½è¦†ç›–æ•°æ®ã€‚ï¼ˆä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ’å…¥æ–°èŠ‚ç‚¹ï¼Œä¼šæœ‰Bè¦†ç›–Açš„æƒ…å†µï¼‰</p>
<p>3ï¼‰sizeè®¡æ•°ä¸å‡†ç¡®ï¼ˆéåŸå­æ“ä½œï¼‰ã€‚ï¼ˆä¸¤ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å½“å‰size = 5ï¼Œéƒ½è®¤ä¸ºsize = 5+1 = 6ï¼Œå®é™…ä¸Šåº”è¯¥æ˜¯ 7 äº†ã€‚ï¼‰</p>
<div class="gap"></div>
<p>Q2ï¼šHashMapçš„è´Ÿè½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Ÿ</p>
<p>å›ç­”è¦ç‚¹ï¼š</p>
<p>1ï¼‰ç©ºé—´ä¸æ—¶é—´çš„æƒè¡¡ï¼š0.75åœ¨ç»Ÿè®¡å­¦ä¸Šæ˜¯æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
<p>2ï¼‰æ³Šæ¾åˆ†å¸ƒï¼šé“¾è¡¨é•¿åº¦â‰¥8çš„æ¦‚ç‡æä½ï¼ˆçº¦0.00000006ï¼‰ã€‚</p>
<p>3ï¼‰Spring Bootåº”ç”¨ï¼šå¯ä»¥æ ¹æ®å®é™…åœºæ™¯è°ƒæ•´ï¼Œå¦‚ç¼“å­˜å¯†é›†çš„åº”ç”¨å¯é™ä½è´Ÿè½½å› å­ã€‚</p>
<div class="gap"></div>
<p>Q3ï¼šSpring Bootä¸­å¦‚ä½•æ­£ç¡®ä½¿ç”¨HashMapï¼Ÿ</p>
<p>å›ç­”è¦ç‚¹ï¼š</p>
<div class="gap"></div>
<p>1ï¼‰ä¼˜å…ˆä½¿ç”¨ConcurrentHashMapå¤„ç†å…±äº«æ•°æ®ã€‚</p>
<p>2ï¼‰è€ƒè™‘ä½¿ç”¨Guava Cacheæˆ–Caffeineä½œä¸ºç¼“å­˜å®ç°ã€‚</p>
<p>3ï¼‰Rest APIè¿”å›æ—¶ä½¿ç”¨DTOè€Œéç›´æ¥è¿”å›HashMapã€‚</p>
<p>4ï¼‰é…ç½®ç±»ä¸­çš„Mapå¯ä½¿ç”¨@ConfigurationPropertiesè‡ªåŠ¨ç»‘å®šã€‚</p>
<div class="gap"></div>
<p>Q4ï¼šè´Ÿè½½å› å­ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯0.75ï¼Ÿ</p>
<p>ç©ºé—´ä¸æ—¶é—´çš„æƒè¡¡ï¼ŒèƒŒåçš„åŸç†æ˜¯æ³Šæ¾åˆ†å¸ƒï¼š</p>
<p>è´Ÿè½½å› å­é«˜ï¼ˆå¦‚1.0ï¼‰ï¼šç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œä½†å“ˆå¸Œå†²çªå¢åŠ ï¼ŒæŸ¥è¯¢å˜æ…¢ã€‚åƒæŒ¤æ»¡äººçš„ç”µæ¢¯ï¼Œç©ºé—´ç”¨è¶³äº†ï¼Œä½†è°éƒ½åŠ¨ä¸äº†ï¼Œæ•ˆç‡æä½ã€‚</p>
<p>è´Ÿè½½å› å­ä½ï¼ˆå¦‚0.5ï¼‰ï¼šå†²çªå°‘ï¼ŒæŸ¥è¯¢å¿«ï¼Œä½†ç©ºé—´æµªè´¹ï¼Œæ‰©å®¹é¢‘ç¹ã€‚åƒç©ºæ—·çš„åœè½¦åœºï¼Œåœè½¦å®¹æ˜“ï¼Œä½†åœŸåœ°é—²ç½®å¤ªå¤šï¼Œä¸ç»æµã€‚</p>
<div class="gap"></div>
<p>0.75 åƒé«˜å³°æœŸçš„åœ°é“ï¼Œæœ‰ä¸€å®šæ‹¥æŒ¤ï¼Œä½†æ•´ä½“è¿è¡Œæ•ˆç‡æœ€é«˜ã€‚</p>
<div class="gap"></div>
<p>Q5ï¼šå¦‚æœkeyä¸ºnullï¼Œå­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ</p>
<p>å¦‚æœkey = nullï¼Œåˆ™ä¸º0ã€‚æ ¹æ®æºç ï¼šhash = (key == null) ? 0 : hash(key)</p>
<div class="gap"></div>
<p>Q6ï¼šHashMapå’ŒConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<div class="gap"></div>
<p>å¯¹æ¯”ç»´åº¦	HashMap	ConcurrentHashMap (JDK 1.8)</p>
<p>çº¿ç¨‹å®‰å…¨	ä¸å®‰å…¨	å®‰å…¨</p>
<p>é”æœºåˆ¶	æ— é”	åˆ†æ®µé” + CAS + synchronizedï¼ˆé”å•ä¸ªæ¡¶ï¼‰</p>
<p>æ€§èƒ½	é«˜ï¼ˆæ— é”ï¼‰	è¾ƒé«˜ï¼ˆé”ç²’åº¦ç»†ï¼‰</p>
<p>è¿­ä»£å™¨	å¿«é€Ÿå¤±è´¥ (fail-fast)	å¼±ä¸€è‡´æ€§ (weakly consistent)</p>
<p>Nullå€¼	å…è®¸	ä¸å…è®¸é”®æˆ–å€¼ä¸ºnullï¼ˆé¿å…æ­§ä¹‰ï¼‰</p>
<p>ä½¿ç”¨åœºæ™¯	å•çº¿ç¨‹ã€å±€éƒ¨å˜é‡ã€åªè¯»å…±äº«	å¤šçº¿ç¨‹é«˜å¹¶å‘ç¯å¢ƒ</p>
<div class="gap"></div>
<div class="gap"></div>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<div class="gap"></div>
<p>MySQL ç´¢å¼•</p>
<p>B+Treeï¼šMySQL InnoDBé»˜è®¤ã€‚å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜é”®ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºã€‚</p>
<div class="gap"></div>
<p>Q1ï¼šB+Tree å¯¹æ¯” B-Tree</p>
<p>ç‰¹æ€§	B-Tree	B+Tree (MySQLé‡‡ç”¨)</p>
<p>æ•°æ®å­˜å‚¨	æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜æ•°æ®	åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹çº¯ç´¢å¼•</p>
<p>å¶å­èŠ‚ç‚¹	æ— é“¾è¡¨é“¾æ¥	é€šè¿‡åŒå‘é“¾è¡¨é“¾æ¥ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢</p>
<p>æŸ¥è¯¢ç¨³å®šæ€§	ä¸ç¨³å®šï¼ˆæ•°æ®å¯èƒ½åœ¨ä¸­é—´èŠ‚ç‚¹æ‰¾åˆ°ï¼‰	ç¨³å®šï¼ˆå¿…é¡»åˆ°å¶å­èŠ‚ç‚¹ï¼‰</p>
<p>é€‚ç”¨åœºæ™¯	éšæœºæ£€ç´¢	èŒƒå›´æŸ¥è¯¢ã€æ’åºã€å…¨è¡¨æ‰«æ</p>
<div class="gap"></div>
<p>Q2ï¼šèšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•</p>
<p>ç»´åº¦	èšç°‡ç´¢å¼• (InnoDBä¸»é”®ç´¢å¼•)	éèšç°‡ç´¢å¼• (äºŒçº§ç´¢å¼•)</p>
<p>æ•°æ®å­˜å‚¨	ç´¢å¼•ä¸æ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼ˆå¶å­èŠ‚ç‚¹å°±æ˜¯æ•°æ®è¡Œï¼‰	å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ï¼Œéœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®</p>
<p>æ•°é‡	æ¯è¡¨ä»…ä¸€ä¸ª	å¯æœ‰å¤šä¸ª</p>
<p>åˆ›å»º	è‡ªåŠ¨æŒ‰ä¸»é”®åˆ›å»ºï¼Œæ— ä¸»é”®åˆ™é€‰å”¯ä¸€éç©ºåˆ—	æ‰‹åŠ¨åˆ›å»º</p>
<p>æ€§èƒ½	ä¸»é”®æŸ¥è¯¢æå¿«	éœ€è¦å›è¡¨ï¼Œå¯èƒ½æ…¢</p>
<div class="gap"></div>
<p>Q3ï¼šæœ€å·¦å‰ç¼€åŸåˆ™</p>
<div class="gap"></div>
<p>Q4ï¼šè¦†ç›–ç´¢å¼•</p>
<p>å®šä¹‰ï¼šæŸ¥è¯¢çš„å­—æ®µå…¨éƒ¨åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œæ— éœ€å›è¡¨ã€‚</p>
<div class="gap"></div>
<p>ç¤ºä¾‹ï¼š</p>
<p>-- è¡¨ user æœ‰ç´¢å¼• (name, age)</p>
<p>SELECT name, age FROM user WHERE name = &#x27;å¼ ä¸‰&#x27;; -- âœ… è¦†ç›–ç´¢å¼•</p>
<p>SELECT * FROM user WHERE name = &#x27;å¼ ä¸‰&#x27;;        -- âŒ éœ€è¦å›è¡¨</p>
<div class="gap"></div>
<p>Q5ï¼šå¦‚ä½•åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Ÿ</p>
<p>EXPLAIN å…³é”®å­—æ®µï¼š</p>
<div class="gap"></div>
<p>typeï¼šsystem &gt; const &gt; ref &gt; range &gt; index &gt; ALLï¼ˆæœ€å¥½åˆ°æœ€å·®ï¼‰ã€‚</p>
<p>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚</p>
<p>rowsï¼šé¢„ä¼°æ‰«æè¡Œæ•°ã€‚</p>
<div class="gap"></div>
<p>Extraï¼š</p>
<p>Using indexï¼šè¦†ç›–ç´¢å¼•ã€‚</p>
<p>Using filesortï¼šéœ€è¦é¢å¤–æ’åºã€‚</p>
<p>Using temporaryï¼šç”¨äº†ä¸´æ—¶è¡¨ã€‚</p>
<div class="gap"></div>
<p>Q5ï¼šå¤§è¡¨å¦‚ä½•æ·»åŠ ç´¢å¼•ï¼Ÿ</p>
<p>é—®é¢˜ï¼šç›´æ¥ ALTER TABLE ä¼šé”è¡¨ï¼Œé˜»å¡ä¸šåŠ¡ã€‚</p>
<div class="gap"></div>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>1ï¼‰åœ¨çº¿DDLå·¥å…·ï¼špt-online-schema-change (Percona Toolkit)ã€‚</p>
<p>2ï¼‰ä¸šåŠ¡ä½å³°æœŸæ“ä½œã€‚</p>
<p>3ï¼‰å…ˆåŠ ä»åº“ï¼Œå†åˆ‡æ¢ã€‚</p>
<div class="gap"></div>
<p>Q6ï¼šä»€ä¹ˆæƒ…å†µä¸‹å»ºäº†ç´¢å¼•ä½†ç”¨ä¸ä¸Šï¼Ÿ</p>
<p>1) è¿åæœ€å·¦å‰ç¼€åŸåˆ™ï¼›</p>
<p>2) å¯¹ç´¢å¼•åˆ—åšäº†è®¡ç®—æˆ–å‡½æ•°ï¼›</p>
<p>3) å‘ç”Ÿäº†ç±»å‹éšå¼è½¬æ¢ï¼›</p>
<p>4) ä½¿ç”¨ORä¸”éƒ¨åˆ†åˆ—æ— ç´¢å¼•ï¼›</p>
<p>5) ä½¿ç”¨!=æˆ–NOT INï¼›</p>
<p>6) LIKEä»¥é€šé…ç¬¦å¼€å¤´ï¼›</p>
<p>7) ä¼˜åŒ–å™¨åˆ¤æ–­å…¨è¡¨æ‰«ææ›´å¿«ï¼ˆæ•°æ®é‡å°‘æ—¶ï¼‰ã€‚</p>
<div class="gap"></div>
<p>Q7ï¼šå¦‚ä½•ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼Ÿ</p>
<p>1) EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’ï¼›</p>
<p>2) æ£€æŸ¥æ˜¯å¦ç”¨ä¸Šåˆé€‚ç´¢å¼•ï¼›</p>
<p>3) è€ƒè™‘é‡å†™SQLï¼Œæ¯”å¦‚æ‹†åˆ†å¤æ‚æŸ¥è¯¢ã€ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼›</p>
<p>4) è°ƒæ•´ç´¢å¼•æˆ–è¡¨ç»“æ„ï¼›</p>
<p>5) å¯¹äºæ·±åˆ†é¡µç”¨id &gt; xxx LIMITä¼˜åŒ–ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>äº‹åŠ¡éš”ç¦»çº§åˆ«</p>
<div class="gap"></div>
<p>éš”ç¦»çº§åˆ«	è„è¯»	ä¸å¯é‡å¤è¯»	å¹»è¯»	å®ç°æœºåˆ¶	æ€§èƒ½</p>
<p>è¯»æœªæäº¤</p>
<p>(Read Uncommitted)	âœ… å¯èƒ½	âœ… å¯èƒ½	âœ… å¯èƒ½	å‡ ä¹æ— é”	æœ€é«˜</p>
<div class="gap"></div>
<p>è¯»å·²æäº¤</p>
<p>(Read Committed)	âŒ é¿å…	âœ… å¯èƒ½	âœ… å¯èƒ½	è¯­å¥çº§å¿«ç…§	é«˜</p>
<div class="gap"></div>
<p>å¯é‡å¤è¯»</p>
<p>(Repeatable Read)	âŒ é¿å…	âŒ é¿å…	âœ… å¯èƒ½	äº‹åŠ¡çº§å¿«ç…§ + Gap Lock (MySQL)	ä¸­</p>
<div class="gap"></div>
<p>ä¸²è¡ŒåŒ–</p>
<p>(Serializable)	        âŒ é¿å…	âŒ é¿å…	âŒ é¿å…	å®Œå…¨åŠ é”	æœ€ä½</p>
<div class="gap"></div>
<div class="gap"></div>
<p>è„è¯»ï¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</p>
<p>ä¸å¯é‡å¤è¯»ï¼šåŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤æ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®ï¼Œç»“æœä¸åŒï¼ˆå› ä¸ºå…¶ä»–äº‹åŠ¡ä¿®æ”¹å¹¶æäº¤äº†ï¼‰ã€‚</p>
<p>å¹»è¯»ï¼šåŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤æ¬¡ç›¸åŒçš„èŒƒå›´æŸ¥è¯¢ï¼Œè¿”å›çš„è¡Œæ•°ä¸åŒï¼ˆå› ä¸ºå…¶ä»–äº‹åŠ¡æ’å…¥/åˆ é™¤å¹¶æäº¤äº†ï¼‰ã€‚</p>
<div class="gap"></div>
<p>Q1ï¼šMySQLé»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ</p>
<p>MySQL InnoDBçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰ã€‚å®ƒé€šè¿‡MVCCè§£å†³äº†è„è¯»å’Œä¸å¯é‡å¤è¯»é—®é¢˜ã€‚å¯¹äºå¹»è¯»ï¼ŒInnoDBåœ¨REPEATABLE READä¸‹é€šè¿‡Next-Key Lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰åœ¨åŠ é”æŸ¥è¯¢ï¼ˆå¦‚SELECT ... FOR UPDATEï¼‰æ—¶å¯ä»¥é¿å…ï¼Œä½†æ™®é€šçš„å¿«ç…§è¯»ä»å¯èƒ½é‡åˆ°å¹»è¯»ã€‚æ‰€ä»¥MySQLçš„REPEATABLE READå®é™…ä¸Šæ¯”SQLæ ‡å‡†çš„è¦æ±‚æ›´ä¸¥æ ¼ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>ä¸ºäº†è§£å†³å¹»è¯»ï¼ŒMySQLåœ¨REPEATABLE READä¸‹ä½¿ç”¨äº†Next-Key Lockingæœºåˆ¶ã€‚</p>
<p>1ï¼‰Next-Key Lock = Record Lock + Gap Lockï¼š</p>
<p>-- å‡è®¾usersè¡¨æ•°æ®ï¼š</p>
<p>-- id: 1, 3, 5, 7, 9</p>
<p>-- age: 20, 25, 30, 35, 40</p>
<div class="gap"></div>
<p>-- äº‹åŠ¡1</p>
<p>START TRANSACTION;</p>
<p>SELECT * FROM users WHERE age = 30 FOR UPDATE;</p>
<div class="gap"></div>
<p>-- Next-Key Locké”å®šçš„èŒƒå›´ï¼š</p>
<p>-- 1. Record Lockï¼šé”ä½age=30è¿™è¡Œ</p>
<p>-- 2. Gap Lockï¼šé”ä½(25, 30)å’Œ(30, 35)è¿™ä¸¤ä¸ªé—´éš™</p>
<p>-- 3. å…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨(25, 35)èŒƒå›´å†…æ’å…¥æ•°æ®</p>
<div class="gap"></div>
<p>-- äº‹åŠ¡2å°è¯•æ’å…¥ä¼šè¢«é˜»å¡</p>
<p>START TRANSACTION;</p>
<p>INSERT INTO users (name, age) VALUES (&#x27;test&#x27;, 28);  -- é˜»å¡ï¼Œå› ä¸º28åœ¨(25,30)é—´éš™</p>
<p>INSERT INTO users (name, age) VALUES (&#x27;test&#x27;, 32);  -- é˜»å¡ï¼Œå› ä¸º32åœ¨(30,35)é—´éš™</p>
<div class="gap"></div>
<p>2ï¼‰ä¸åŒæŸ¥è¯¢æ¡ä»¶çš„åŠ é”ç­–ç•¥</p>
<p>-- ç¤ºä¾‹æ•°æ®ï¼šid (1,3,5,7), age (18,22,25,30)</p>
<div class="gap"></div>
<p>-- 1. ç­‰å€¼æŸ¥è¯¢ï¼ˆage = 25ï¼‰</p>
<p>SELECT * FROM users WHERE age = 25 FOR UPDATE;</p>
<p>-- åŠ é”ï¼šrecord lock (age=25) + gap lock (22,25) + gap lock (25,30)</p>
<div class="gap"></div>
<p>-- 2. èŒƒå›´æŸ¥è¯¢ï¼ˆage &gt; 20ï¼‰</p>
<p>SELECT * FROM users WHERE age &gt; 20 FOR UPDATE;</p>
<p>-- åŠ é”ï¼šæ‰€æœ‰age&gt;20çš„è®°å½•é” + æ‰€æœ‰ç›¸å…³é—´éš™é”</p>
<p>-- é˜»æ­¢åœ¨(20, âˆ)èŒƒå›´å†…æ’å…¥</p>
<div class="gap"></div>
<p>-- 3. æ— åŒ¹é…è®°å½•çš„æŸ¥è¯¢ï¼ˆage = 23ï¼‰</p>
<p>SELECT * FROM users WHERE age = 23 FOR UPDATE;</p>
<p>-- åŠ é”ï¼šgap lock (22,25) </p>
<p>-- è™½ç„¶æ²¡æ‰¾åˆ°è®°å½•ï¼Œä½†é”å®šäº†è¿™ä¸ªé—´éš™</p>
<div class="gap"></div>
<p>Q2ï¼šå¦‚ä½•é€‰æ‹©éš”ç¦»çº§åˆ«ï¼Ÿ</p>
<p>è¯»å·²æäº¤ï¼ˆREAD COMMITTEDï¼‰ï¼šå¤§å¤šæ•°Webåº”ç”¨çš„é€‰æ‹©ã€‚å¹³è¡¡äº†æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…è„è¯»ï¼Œæ¥å—ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚Oracleé»˜è®¤ï¼Œæ¨èé‡‘èå¤–çš„å¤šæ•°åœºæ™¯ã€‚</p>
<div class="gap"></div>
<p>å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ï¼šéœ€è¦äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§çš„åœºæ™¯ï¼Œå¦‚å¯¹è´¦ã€æŠ¥è¡¨ç”Ÿæˆã€‚MySQLé»˜è®¤ã€‚</p>
<div class="gap"></div>
<p>ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰ï¼šç»å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ï¼Œå¦‚é“¶è¡Œæ ¸å¿ƒäº¤æ˜“ï¼Œä½†æ€§èƒ½ä»£ä»·é«˜ã€‚</p>
<div class="gap"></div>
<p>Q3ï¼šä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ° SERIALIZABLEï¼Ÿ</p>
<p>ä¸¤ç§å…¸å‹åœºæ™¯ï¼š</p>
<div class="gap"></div>
<p>ä½™é¢æ£€æŸ¥ä¸æ‰£æ¬¾ï¼šéœ€è¦å…ˆSELECTæŸ¥ä½™é¢ï¼Œå†UPDATEæ‰£æ¬¾ã€‚åœ¨éä¸²è¡ŒåŒ–çº§åˆ«ä¸‹ï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½åœ¨ä¸¤è€…ä¹‹é—´ä¿®æ”¹ä½™é¢ï¼Œå¯¼è‡´è¶…é¢æ‰£æ¬¾ã€‚</p>
<div class="gap"></div>
<p>å”¯ä¸€æ€§å¤æ‚æ ¡éªŒï¼šéœ€è¦æŸ¥è¯¢å¤šå¼ è¡¨åæ’å…¥ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€ã€‚å¯ç”¨SERIALIZABLEé…åˆSELECT ... FOR UPDATEï¼Œä½†å®é™…æ›´å¸¸ç”¨ä¹è§‚é”æˆ–åˆ†å¸ƒå¼é”æ›¿ä»£ï¼Œå› ä¸ºæ€§èƒ½æ›´å¥½ã€‚</p>
<div class="gap"></div>
<p>Q4ï¼šå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼š</p>
<div class="gap"></div>
<p>äº‹åŠ¡Açš„æ“ä½œ	çœ‹åˆ°çš„æ•°æ®ç‰ˆæœ¬	åŸå› </p>
<p>SELECTï¼ˆå¿«ç…§è¯»ï¼‰	1000ï¼ˆæ—§ç‰ˆæœ¬ï¼‰	MVCCï¼šä½¿ç”¨äº‹åŠ¡å¼€å§‹æ—¶çš„è¯»è§†å›¾ï¼ˆæ ¹æ®MVVCï¼Œçœ‹åˆ°çš„æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®å¿«ç…§ï¼‰</p>
<p>SELECT ... FOR UPDATE	900ï¼ˆæ–°ç‰ˆæœ¬ï¼‰	å½“å‰è¯»ï¼šç»•è¿‡MVCCï¼Œè¯»å–æœ€æ–°å·²æäº¤æ•°æ®å¹¶åŠ é”</p>
<p>UPDATE	900ï¼ˆæ–°ç‰ˆæœ¬ï¼‰	å½“å‰è¯»ï¼šå¿…é¡»åŸºäºæœ€æ–°æ•°æ®ä¿®æ”¹ï¼ˆäº‹åŠ¡Bä¿®æ”¹åçš„900ï¼‰</p>
<div class="gap"></div>
<p>æ‰€ä»¥ï¼Œåœ¨æ¶‰åŠä½™é¢æ‰£å‡ã€åº“å­˜å‡å°‘ç­‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒSELECT ... FOR UPDATE ä¸æ˜¯å¯é€‰é¡¹ï¼Œè€Œæ˜¯å¿…é€‰é¡¹ï¼ˆå»ºè®® REPEATABLE READ + SELECT ... FOR UPDATEï¼‰</p>
<div class="gap"></div>
<p>Q5ï¼š</p>
<p>UPDATE accounts SET balance=balance-? WHERE id=? AND balance&gt;=?</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>JVM å†…å­˜æ¨¡å‹ï¼ˆç®€å•ï¼‰</p>
<p>Q1ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿ StackOverflowErrorï¼Ÿ</p>
<p>// ç¤ºä¾‹1ï¼šé€’å½’è°ƒç”¨æ— ç»ˆæ­¢æ¡ä»¶</p>
<pre><code>public class StackOverflowDemo {
    public void infiniteRecursion() {
        infiniteRecursion();  // âŒ æ— é™é€’å½’ï¼Œæ ˆå¸§ä¸æ–­åˆ›å»º
    }
}</code></pre>
<div class="gap"></div>
<p>// ç¤ºä¾‹2ï¼šæ–¹æ³•è°ƒç”¨å±‚çº§è¿‡æ·±</p>
<pre><code>public class DeepCallChain {
    public void level1() { level2(); }
    public void level2() { level3(); }
    // ... æŒç»­è°ƒç”¨å‡ ç™¾å±‚
    public void level1000() { /* æ“ä½œ */ }
}</code></pre>
<div class="gap"></div>
<p>// è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code>public class SafeRecursion {
    // 1. è®¾ç½®é€’å½’ç»ˆæ­¢æ¡ä»¶
    public int factorial(int n) {
        if (n &lt;= 1) return 1;  // âœ… ç»ˆæ­¢æ¡ä»¶
        return n * factorial(n - 1);
    }
    
    // 2. ä½¿ç”¨è¿­ä»£æ›¿ä»£é€’å½’
    public int factorialIterative(int n) {
        int result = 1;
        for (int i = 1; i &lt;= n; i++) {
            result *= i;
        }
        return result;
    }
}</code></pre>
<div class="gap"></div>
<p>Q2ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿ Heap OOMï¼Ÿå¦‚ä½•æ’æŸ¥ï¼Ÿ</p>
<p>// å¸¸è§Heap OOMåœºæ™¯ï¼š</p>
<pre><code>public class HeapOOMDemo {
    // 1. å†…å­˜æ³„éœ²
    private static final List&lt;Object&gt; LEAK_LIST = new ArrayList&lt;&gt;();
    
    public void memoryLeak() {
        while (true) {
            LEAK_LIST.add(new byte[1024 * 1024]);  // 1MB
            // å¯¹è±¡è¢«é™æ€é›†åˆå¼•ç”¨ï¼Œæ— æ³•GC
        }
    }
    
    // 2. å¤§å¯¹è±¡åˆ›å»º
    public void createLargeObjects() {
        List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; 1000; i++) {
            list.add(new byte[1024 * 1024 * 10]);  // 10MBæ¯ä¸ª
        }
    }
    
    // 3. è¿‡å¤šçº¿ç¨‹åˆ›å»ºå¯¹è±¡
    public void multiThreadOOM() {
        ExecutorService executor = Executors.newFixedThreadPool(100);
        for (int i = 0; i &lt; 1000; i++) {
            executor.submit(() -&gt; {
                byte[] data = new byte[1024 * 1024];  // æ¯ä¸ªçº¿ç¨‹1MB
                // å¤„ç†...
            });
        }
    }
}</code></pre>
<div class="gap"></div>
<p>Q3ï¼šSpring Boot ä¸­å¸¸è§çš„å†…å­˜æ³„éœ²åœºæ™¯ï¼Ÿ</p>
<pre><code>@Component</code></pre>
<pre><code>public class CommonMemoryLeakInSpring {
    
    // 1. é™æ€é›†åˆå¼•ç”¨Spring Bean
    private static Map&lt;String, Object&gt; cache = new HashMap&lt;&gt;();
    
    @Autowired
    private UserService userService;
    
    @PostConstruct
    public void init() {
        cache.put(&quot;userService&quot;, userService);  // âŒ Spring Beanè¢«é™æ€å¼•ç”¨
    }
    
    // 2. ThreadLocalæœªæ¸…ç†
    private static ThreadLocal&lt;HttpServletRequest&gt; requestHolder = 
        new ThreadLocal&lt;&gt;();
    
    public void processRequest(HttpServletRequest request) {
        requestHolder.set(request);
        // ... ä¸šåŠ¡å¤„ç†
        
        // âŒ å¿˜è®°æ¸…ç†
        // requestHolder.remove();  // åº”è¯¥è°ƒç”¨
    }
    
    // 3. ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void registerListener() {
        ApplicationListener&lt;MyEvent&gt; listener = event -&gt; {
            // å¤„ç†äº‹ä»¶
        };
        
        eventPublisher.publishEvent(new MyEvent(this));
        // âŒ ç›‘å¬å™¨å¯èƒ½è¢«é•¿æœŸæŒæœ‰
    }
    
    // 4. å¤§é‡ç¼“å­˜æœªè®¾ç½®è¿‡æœŸ
    @Autowired
    private CacheManager cacheManager;
    
    public void cacheData(String key, Object value) {
        // âŒ æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´
        cacheManager.getCache(&quot;myCache&quot;).put(key, value);
    }
}</code></pre>
<div class="gap"></div>
<p>// æ’æŸ¥å·¥å…·å’Œå‘½ä»¤ï¼š</p>
<p>// 1. jps - æŸ¥çœ‹Javaè¿›ç¨‹</p>
<p>// 2. jstat -gc &lt;pid&gt; 1000 - GCç»Ÿè®¡</p>
<p>// 3. jmap -heap &lt;pid&gt; - å †ä¿¡æ¯</p>
<p>// 4. jmap -histo:live &lt;pid&gt; | head -20 - å¯¹è±¡ç»Ÿè®¡</p>
<p>// 5. jmap -dump:format=b,file=heap.hprof &lt;pid&gt; - å †è½¬å‚¨</p>
<p>// 6. jhat æˆ– MAT åˆ†æå †è½¬å‚¨æ–‡ä»¶</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>Q4ï¼šå¦‚ä½•ç›‘æ§ Spring Boot åº”ç”¨çš„å†…å­˜ä½¿ç”¨ï¼Ÿ</p>
<p>// 1. Spring Boot Actuator ç«¯ç‚¹</p>
<pre><code>@Configuration</code></pre>
<pre><code>@EnableWebMvc</code></pre>
<pre><code>public class ActuatorConfig {
    // å¯ç”¨å†…å­˜ç›¸å…³ç«¯ç‚¹
}</code></pre>
<div class="gap"></div>
<p>// application.yml</p>
<p>management:</p>
<p>  endpoints:</p>
<pre><code>    web:
      exposure:
        include: &quot;health,info,metrics,prometheus,heapdump&quot;</code></pre>
<p>  endpoint:</p>
<pre><code>    health:
      show-details: always
    heapdump:
      enabled: true</code></pre>
<p>  metrics:</p>
<pre><code>    export:
      prometheus:
        enabled: true</code></pre>
<p>// 2. è‡ªå®šä¹‰å†…å­˜ç›‘æ§</p>
<pre><code>@Component</code></pre>
<pre><code>public class MemoryMonitor {
    
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿç›‘æ§ä¸€æ¬¡
    public void monitorMemory() {
        Runtime runtime = Runtime.getRuntime();
        long total = runtime.totalMemory();
        long free = runtime.freeMemory();
        long used = total - free;
        long max = runtime.maxMemory();
        
        double usedPercentage = (double) used / max * 100;
        
        if (usedPercentage &gt; 80) {
            // å‘é€å‘Šè­¦
            alertService.sendAlert(&quot;å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: &quot; + usedPercentage + &quot;%&quot;);
        }
        
        // è®°å½•åˆ°æ—¥å¿—
        log.info(&quot;Memory Usage - Used: {}MB, Free: {}MB, Max: {}MB, Usage: {}%&quot;,
                used / 1024 / 1024,
                free / 1024 / 1024,
                max / 1024 / 1024,
                String.format(&quot;%.2f&quot;, usedPercentage));
    }
}</code></pre>
<div class="gap"></div>
<p>// 3. ä½¿ç”¨Micrometerç›‘æ§</p>
<pre><code>@Bean</code></pre>
<pre><code>public MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCommonTags() {
    return registry -&gt; registry.config().commonTags(
        &quot;application&quot;, &quot;myapp&quot;,
        &quot;region&quot;, System.getenv(&quot;REGION&quot;)
    );
}</code></pre>
<div class="gap"></div>
<p>// 4. é›†æˆAPMå·¥å…·</p>
<p>// SkyWalkingã€Pinpointã€Arthasç­‰</p>
<div class="gap"></div>
<div class="gap"></div>
<p>Q5ï¼šå¦‚ä½•ä¼˜åŒ– Spring Boot åº”ç”¨çš„å†…å­˜ä½¿ç”¨ï¼Ÿ</p>
<p>// å®æˆ˜ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<pre><code>@Configuration</code></pre>
<pre><code>public class MemoryOptimizationConfig {
    
    // 1. Beanä¼˜åŒ–
    @Bean
    @Scope(&quot;prototype&quot;)  // æŒ‰éœ€åˆ›å»ºï¼Œé¿å…å•ä¾‹æŒæœ‰è¿‡å¤šæ•°æ®
    public ExpensiveBean expensiveBean() {
        return new ExpensiveBean();
    }
    
    // 2. ä½¿ç”¨å¼±å¼•ç”¨ç¼“å­˜
    @Bean
    public CacheManager cacheManager() {
        return new ConcurrentMapCacheManager() {
            @Override
            protected Cache createConcurrentMapCache(String name) {
                return new ConcurrentMapCache(name, 
                    CacheBuilder.newBuilder()
                        .maximumSize(1000)
                        .expireAfterWrite(10, TimeUnit.MINUTES)
                        .weakValues()  // ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå†…å­˜ä¸è¶³æ—¶å¯è¢«GC
                        .build().asMap(),
                    false);
            }
        };
    }
    
    // 3. æµå¼å¤„ç†å¤§æ•°æ®ï¼šæµå¤„ç†ï¼Œä½¿ç”¨ç¼“å†²åŒºï¼Œæ¯æ¬¡åªè¯»å–ä¸€å°éƒ¨åˆ†æ•°æ®åˆ°å†…å­˜
    @Service
    public class StreamProcessingService {
        
        @Transactional(readOnly = true)
        public void processLargeData() {
            // âŒ é”™è¯¯ï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
            // List&lt;User&gt; users = userRepository.findAll();
            
            // âœ… æ­£ç¡®ï¼šä½¿ç”¨æµå¼æŸ¥è¯¢
            try (Stream&lt;User&gt; userStream = userRepository.findAllByStream()) {
                userStream
                    .filter(user -&gt; user.isActive())
                    .forEach(this::processUser);
            }
        }
    }
    
    // 4. åˆç†ä½¿ç”¨Session
    @Configuration
    @EnableRedisHttpSession(
        maxInactiveIntervalInSeconds = 1800,  // 30åˆ†é’Ÿè¿‡æœŸ
        redisNamespace = &quot;mysession&quot;
    )
    public class SessionConfig {
        // ä½¿ç”¨Rediså­˜å‚¨Sessionï¼Œé¿å…å†…å­˜ä¸­å­˜å‚¨å¤§é‡Session
    }
    
    // 5. å›¾ç‰‡/æ–‡ä»¶å¤„ç†ä¼˜åŒ–
    @Service
    public class ImageService {
        
        public void processImage(MultipartFile file) throws IOException {
            // âŒ é”™è¯¯ï¼šç›´æ¥è¯»å–åˆ°byte[]
            // byte[] data = file.getBytes();
            
            // âœ… æ­£ç¡®ï¼šä½¿ç”¨æµå¤„ç†
            try (InputStream is = file.getInputStream();
                 BufferedImage image = ImageIO.read(is)) {
                // å¤„ç†å›¾ç‰‡
            }
        }
    }
    
    // 6. çº¿ç¨‹æ± ä¼˜åŒ–
    @Bean
    public Executor asyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);          // æ ¸å¿ƒçº¿ç¨‹æ•°
        executor.setMaxPoolSize(10);          // æœ€å¤§çº¿ç¨‹æ•°
        executor.setQueueCapacity(100);       // é˜Ÿåˆ—å®¹é‡
        executor.setThreadNamePrefix(&quot;Async-&quot;);
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
}</code></pre>
<div class="gap"></div>
<p>Q6ï¼šSpring ç®¡ç†çš„ Bean æœ‰å‡ ç§ä½œç”¨åŸŸï¼š</p>
<pre><code>@Component</code></pre>
<pre><code>public class BeanScopeDemo {
    
    // 1. singletonï¼ˆé»˜è®¤ï¼‰ï¼šæ•´ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
    @Scope(&quot;singleton&quot;)  // æˆ– @Scope(ConfigurableBeanFactory.SCOPE_SINGLETON)
    @Bean
    public SingletonBean singletonBean() {
        // æ¯æ¬¡getBean()è¿”å›åŒä¸€ä¸ªå®ä¾‹
        return new SingletonBean();
    }
    
    // 2. prototypeï¼šæ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°å®ä¾‹
    @Scope(&quot;prototype&quot;)  // æˆ– @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
    @Bean
    public PrototypeBean prototypeBean() {
        // æ¯æ¬¡getBean()è¿”å›æ–°å®ä¾‹
        return new PrototypeBean();
    }
    
    // 3. å…¶ä»–Webç›¸å…³ä½œç”¨åŸŸï¼ˆéœ€è¦Webç¯å¢ƒï¼‰
    // request: æ¯ä¸ªHTTPè¯·æ±‚ä¸€ä¸ªæ–°å®ä¾‹
    // session: æ¯ä¸ªç”¨æˆ·ä¼šè¯ä¸€ä¸ªæ–°å®ä¾‹  
    // application: ServletContextç”Ÿå‘½å‘¨æœŸ
    // websocket: WebSocketä¼šè¯ç”Ÿå‘½å‘¨æœŸ
}</code></pre>
<div class="gap"></div>
<p>Q7ï¼šç”µå•†å¤§ä¿ƒæœŸé—´å†…å­˜é£™å‡</p>
<p>é¢è¯•å®˜ï¼šåŒ11æœŸé—´ï¼Œä½ çš„Spring Bootåº”ç”¨å†…å­˜ä½¿ç”¨ç‡ä»40%çªç„¶æ¶¨åˆ°90%ï¼Œå¦‚ä½•å¿«é€Ÿå®šä½å’Œè§£å†³ï¼Ÿ</p>
<div class="gap"></div>
<h2 id="h-1" class="heading level-1">1. ç«‹å³è¡ŒåŠ¨ï¼ˆ5åˆ†é’Ÿå†…ï¼‰ï¼š</h2>
<pre><code>               a. æŸ¥çœ‹ç›‘æ§ï¼šæ£€æŸ¥GCé¢‘ç‡ã€å †å†…å­˜åˆ†å¸ƒ ï¼ˆæ–¹æ³•ä¸€ï¼šä½¿ç”¨ jstat å‘½ä»¤è¡Œå·¥å…·ï¼Œjps -mlï¼Œjstat -gc &lt;pid&gt; 1000 10ã€‚æ–¹æ³•äºŒï¼šSpring Boot Actuator ç›‘æ§ï¼Œcurl http://localhost:8080/actuator/metrics/jvm.memory.usedï¼Œcurl http://localhost:8080/actuator/metrics/jvm.gc.memory.allocatedï¼‰
               b. é‡å¯å®ä¾‹ï¼šå¿«é€Ÿæ¢å¤æœåŠ¡ï¼ˆå…ˆé‡å¯ä¸€ä¸ªå®ä¾‹ï¼‰</code></pre>
<p># é‡æ–°åŠ è½½systemdé…ç½®</p>
<p>sudo systemctl daemon-reload</p>
<div class="gap"></div>
<p># é‡å¯æœåŠ¡</p>
<p>sudo systemctl restart myapp</p>
<div class="gap"></div>
<p># æŸ¥çœ‹çŠ¶æ€</p>
<p>sudo systemctl status myapp</p>
<div class="gap"></div>
<p># æŸ¥çœ‹æ—¥å¿—</p>
<p>sudo journalctl -u myapp -f</p>
<div class="gap"></div>
<pre><code>               c. æ‰©å®¹ï¼šä¸´æ—¶å¢åŠ å®ä¾‹æ•°
            
            2. è¯Šæ–­åŸå› ï¼ˆ15åˆ†é’Ÿï¼‰ï¼š
               a. è·å–å †è½¬å‚¨ï¼šjmap -dump:live,format=b,file=heap.hprof &lt;pid&gt;
               b. åˆ†æçº¿ç¨‹ï¼šjstack &lt;pid&gt; &gt; thread.txt
               c. æ£€æŸ¥ä¸šåŠ¡ï¼šæ˜¯å¦æœ‰å¤§ä¿ƒç‰¹å®šä»£ç è·¯å¾„
            
            3. å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š
               a. ç¼“å­˜å‡»ç©¿ï¼šå¤§é‡è¯·æ±‚æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®
                  â†’ è§£å†³æ–¹æ¡ˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€ç©ºå€¼ç¼“å­˜
               
               b. æ…¢æŸ¥è¯¢ï¼šæ•°æ®åº“æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®
                  â†’ è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ åˆ†é¡µã€ä¼˜åŒ–ç´¢å¼•
               
               c. å†…å­˜æ³„æ¼ï¼šæ´»åŠ¨Sessionè¿‡å¤š
                  â†’ è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´Sessionè¶…æ—¶æ—¶é—´
               
               d. ä»£ç Bugï¼šæ— é™å¾ªç¯åˆ›å»ºå¯¹è±¡
                  â†’ è§£å†³æ–¹æ¡ˆï¼šä»£ç å®¡æŸ¥ã€ä¿®å¤Bug
            
            4. é¢„é˜²æªæ–½ï¼š
               a. å‹åŠ›æµ‹è¯•ï¼šæå‰æ¨¡æ‹Ÿå¤§ä¿ƒæµé‡
               b. ç†”æ–­é™çº§ï¼šé…ç½®Hystrix/Sentinel
               c. ç›‘æ§å‘Šè­¦ï¼šè®¾ç½®å†…å­˜é˜ˆå€¼å‘Šè­¦
               d. é™æµï¼šé…ç½®æ¥å£QPSé™åˆ¶</code></pre>
<p>Q8ï¼šSpring Bootåº”ç”¨å¯åŠ¨æ…¢</p>
<p>é¢è¯•å®˜ï¼šSpring Bootåº”ç”¨å¯åŠ¨éœ€è¦2åˆ†é’Ÿï¼Œå¦‚ä½•ä¼˜åŒ–åˆ°30ç§’å†…ï¼Ÿ</p>
<div class="gap"></div>
<h2 id="h-1" class="heading level-1">1. ç±»åŠ è½½ä¼˜åŒ–</h2>
<pre><code>       - å‡å°‘ä¾èµ–ï¼šç§»é™¤ä¸å¿…è¦çš„starter
       - æ‰«æä¼˜åŒ–ï¼š@ComponentScanæŒ‡å®šbasePackages ï¼ˆæ‰«æ Spring ç®¡ç†çš„ç»„ä»¶ï¼š@Component, @Service, @Repository, @Controllerï¼Œ@RestController, @Configurationï¼Œè‡ªå®šä¹‰æ³¨è§£ã€‚ä¸æ‰«ææ™®é€šJavaç±»ï¼šDTO/VO/POJO æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ŒEntity å®ä½“ï¼ˆJPAå•ç‹¬å¤„ç†ï¼‰ï¼ŒUtil å·¥å…·ç±»ï¼ŒConstants å¸¸é‡ç±»ï¼ŒEnums æšä¸¾ç±»ï¼‰</code></pre>
<p>// ä¼ä¸šçº§æ¨¡æ¿</p>
<pre><code>@SpringBootApplication(</code></pre>
<pre><code>    scanBasePackages = &quot;com.company.project&quot;,  // Spring Bootè‡ªåŠ¨é…ç½®+æŒ‡å®šåŒ…
    exclude = {
        DataSourceAutoConfiguration.class,      // æ’é™¤ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®
        SecurityAutoConfiguration.class         // è‡ªå®šä¹‰å®‰å…¨é…ç½®
    }</code></pre>
<p>)</p>
<pre><code>@ComponentScan(</code></pre>
<pre><code>    basePackages = {
        &quot;com.company.project.module.web&quot;,
        &quot;com.company.project.module.service&quot;,
        &quot;com.company.project.module.repository&quot;,
        &quot;com.company.project.shared.config&quot;
    },</code></pre>
<pre><code>    excludeFilters = @Filter(
        type = FilterType.REGEX,
        pattern = {
            &quot;.*\\.dto\\..*&quot;,
            &quot;.*\\.vo\\..*&quot;, 
            &quot;.*\\.util\\..*&quot;,
            &quot;.*\\.constant\\..*&quot;
        }
    )</code></pre>
<p>)</p>
<pre><code>@EntityScan(basePackages = &quot;com.company.project.module.entity&quot;)</code></pre>
<pre><code>@EnableJpaRepositories(basePackages = &quot;com.company.project.module.repository&quot;)</code></pre>
<pre><code>public class EnterpriseApplication {
    
    // æ˜¾å¼å¯¼å…¥é¢å¤–é…ç½®
    @Import({
        ThirdPartyIntegrationConfig.class,
        MonitoringConfig.class,
        CacheConfig.class
    })
    @Configuration
    static class AdditionalConfig {
    }
}</code></pre>
<div class="gap"></div>
<pre><code>       - å»¶è¿ŸåŠ è½½ï¼šspring.main.lazy-initialization=true ï¼ˆé»˜è®¤falseï¼Œå¯åŠ¨æ—¶ç«‹å³åˆå§‹åŒ–æ‰€æœ‰Beanã€‚è®¾ç½®ä¸º trueï¼Œå»¶è¿Ÿåˆå§‹åŒ–ï¼Œå¯åŠ¨æ—¶åªåˆ›å»ºBeanå®šä¹‰ï¼Œä½¿ç”¨æ—¶æ‰åˆå§‹åŒ–ã€‚ï¼‰
        
    2. Beanåˆå§‹åŒ–ä¼˜åŒ–
       - @Lazyæ³¨è§£ï¼šå»¶è¿Ÿåˆå§‹åŒ–
       - å¼‚æ­¥åˆå§‹åŒ–ï¼šé…ç½®å¼‚æ­¥Bean
        
    3. JVMä¼˜åŒ–
       - è°ƒæ•´å †å¤§å°ï¼šé¿å…åŠ¨æ€æ‰©å®¹
       - ä½¿ç”¨AOTï¼šSpring Nativeï¼ˆGraalVMï¼‰
       - åˆ†å±‚ç¼–è¯‘ï¼š-XX:+TieredCompilation
        
    4. é…ç½®ä¼˜åŒ–
       - å…³é—­JMXï¼šspring.jmx.enabled=false
       - ç²¾ç®€é…ç½®ï¼šç§»é™¤ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®
        
    5. ä»£ç ä¼˜åŒ–
       - å‡å°‘@PostConstructä¸­çš„è€—æ—¶æ“ä½œ
       - å¼‚æ­¥æ‰§è¡Œåˆå§‹åŒ–ä»»åŠ¡</code></pre>
<p>å…ƒæ•°æ®ï¼ˆMetadataï¼‰æ˜¯&quot;å…³äºæ•°æ®çš„æ•°æ®&quot;</p>
<div class="gap"></div>
<p>// å¥½æ¯”å•†å“çš„ä»·æ ¼æ ‡ç­¾ï¼š</p>
<p>å•†å“ï¼šè‹¹æœ            â† å®é™…æ•°æ®</p>
<p>ä»·æ ¼ï¼šÂ¥5.0            â† å®é™…æ•°æ®</p>
<p>ç”Ÿäº§æ—¥æœŸï¼š2024-01-15   â† å®é™…æ•°æ®</p>
<div class="gap"></div>
<p>&quot;ä»·æ ¼æ ‡ç­¾çš„æ ¼å¼&quot;         â† å…ƒæ•°æ®ï¼ˆæè¿°ä»·æ ¼æ•°æ®å¦‚ä½•å±•ç¤ºï¼‰</p>
<p>&quot;æ—¥æœŸçš„æ˜¾ç¤ºè§„åˆ™&quot;         â† å…ƒæ•°æ®</p>
<p>&quot;å•†å“åˆ†ç±»çš„æ–¹æ³•&quot;         â† å…ƒæ•°æ®</p>
<div class="gap"></div>
<p>æ³¨è§£ï¼ˆAnnotationsï¼‰ - æœ€å¸¸è§çš„å…ƒæ•°æ®</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</p>
<p>ç®€å•å®šä¹‰ï¼šåå°„ï¼ˆReflectionï¼‰æ˜¯ Java åœ¨è¿è¡Œæ—¶æ£€æŸ¥ã€ä¿®æ”¹è‡ªèº«ç»“æ„å’Œè¡Œä¸ºçš„èƒ½åŠ›ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>ç‰¹æ€§	@Component	@Bean</p>
<p>æ³¨è§£ä½ç½®	ç±»çº§åˆ«ï¼ˆClassï¼‰	æ–¹æ³•çº§åˆ«ï¼ˆMethodï¼‰</p>
<p>ä½¿ç”¨åœºæ™¯	è‡ªå·±ç¼–å†™çš„ç±»	ç¬¬ä¸‰æ–¹åº“çš„ç±»ã€éœ€è¦å®šåˆ¶çš„Bean</p>
<p>æ§åˆ¶ç²’åº¦	ç®€å•å®ä¾‹åŒ–	å®Œå…¨æ§åˆ¶å®ä¾‹åŒ–è¿‡ç¨‹</p>
<p>ä¾èµ–æ³¨å…¥	é€šè¿‡å­—æ®µ/æ„é€ å™¨	é€šè¿‡æ–¹æ³•å‚æ•°</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>7.1 é™¤äº† findByï¼ŒSpring Data JPA è¿˜æ”¯æŒå¾ˆå¤šæ¨å¯¼å…³é”®å­—ï¼Œå®ƒä»¬éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š</p>
<div class="gap"></div>
<p>// ç›¸ç­‰æŸ¥è¯¢</p>
<p>List&lt;Task&gt; findByUserId(Long userId);</p>
<p>// å¤šæ¡ä»¶ AND</p>
<p>List&lt;Task&gt; findByUserIdAndStatus(Long userId, String status);</p>
<p>// æ’åº</p>
<p>List&lt;Task&gt; findByUserIdOrderByCreatedAtDesc(Long userId);</p>
<p>// å­˜åœ¨æ€§</p>
<p>boolean existsByUserId(Long userId);</p>
<p>// è®¡æ•°</p>
<p>long countByUserId(Long userId);</p>
<p>// åˆ é™¤</p>
<p>void deleteByUserId(Long userId);</p>
<div class="gap"></div>
<p>7.2 æ¶‰åŠé‡‘é¢å¿…é¡»ç”¨ BigDecimal ï¼Œåƒ double/float ä¼šæœ‰ç²¾åº¦æŸå¤±</p>
<div class="gap"></div>
<p>æ„é€ å¯¹è±¡ï¼š</p>
<p>new BigDecimal(&quot;0.1&quot;) // âœ… ä½¿ç”¨å­—ç¬¦ä¸²æ„é€ </p>
<p>BigDecimal.valueOf(0.1) // âœ… å†…éƒ¨å·²å¤„ç†</p>
<div class="gap"></div>
<p>æ¯”è¾ƒå’Œæ’åºï¼š</p>
<p>bd1.compareTo(bd2) == 0 // âœ… æ¯”è¾ƒå€¼.æ³¨æ„ï¼šequals()è¿˜æ¯”è¾ƒç²¾åº¦(scale)ï¼Œ1.0â‰ 1.00</p>
<p>bd1 == bd2 æˆ– bd1.equals(bd2) // âŒ</p>
<div class="gap"></div>
<p>ç®—æœ¯è¿ç®—:</p>
<p>bd1.add(bd2) // âœ… åŠ æ³•</p>
<p>bd1.multiply(bd2) // âœ… ä¹˜æ³•</p>
<p>bd1 + bd2 // âŒ Javaä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½</p>
<div class="gap"></div>
<p>bd1.divide(bd2, 2, RoundingMode.HALF_UP) // âœ… æŒ‡å®šå°æ•°ä½å’Œèˆå…¥æ¨¡å¼</p>
<p>bd1.divide(bd2) // âŒ å¯èƒ½é™¤ä¸å°½æŠ›å¼‚å¸¸</p>
<div class="gap"></div>
<p>è®¾ç½®ç²¾åº¦ï¼š</p>
<p>bd.setScale(2, RoundingMode.HALF_UP) // âœ… å››èˆäº”å…¥</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.3 é‡æ–°åŠ è½½mavenä¾èµ–</p>
<p>æ–¹æ³•1ï¼šIDEåˆ·æ–°ï¼ˆæ¨èï¼‰</p>
<p>åœ¨ IntelliJ IDEA ä¸­ï¼š</p>
<div class="gap"></div>
<p>å³é”®ç‚¹å‡»é¡¹ç›®æ ¹ç›®å½•çš„ pom.xml</p>
<p>é€‰æ‹© Maven â†’ Reload Project</p>
<div class="gap"></div>
<p>æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ</p>
<p>cd /Users/dengmuwen/Documents/codes/www/my_java_code/demo-api</p>
<p>mvn clean install</p>
<div class="gap"></div>
<p>cd /Users/dengmuwen/Documents/codes/www/my_java_code/demo-api &amp;&amp; mvn dependency:resolve -q</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.4 Mavenå‘½ä»¤</p>
<p>a. â€Œmvn clean package</p>
<p>æ¸…ç†é¡¹ç›®ï¼ˆæ¸…ç† target/ ç›®å½•ï¼‰ï¼Œcompile ç¼–è¯‘ä»£ç ï¼Œtest è¿è¡Œæµ‹è¯•ã€æŒ‡å®špackageæ‰“åŒ…</p>
<div class="gap"></div>
<p>æ€»ç»“æ¥è¯´ï¼Œmvn clean package æ˜¯å°† Spring Boot 2 åº”ç”¨æ‰“åŒ…ä¸ºç‹¬ç«‹å¯æ‰§è¡Œ JAR æ–‡ä»¶çš„æ ‡å‡†ã€æ¨èå‘½ä»¤ï¼Œæ˜¯éƒ¨ç½²åˆ°ç”Ÿäº§æˆ–æµ‹è¯•ç¯å¢ƒå‰çš„å¿…è¦æ­¥éª¤ã€‚â€Œ</p>
<div class="gap"></div>
<p>b. â€Œmvn clean install</p>
<p>æ¸…ç†é¡¹ç›®ï¼ˆæ¸…ç† target/ ç›®å½•ï¼‰ï¼Œcompile ç¼–è¯‘ä»£ç ï¼Œtest è¿è¡Œæµ‹è¯•ã€æŒ‡å®špackageæ‰“åŒ…ã€‚å¹¶å°†ç”Ÿæˆçš„åŒ…æ–‡ä»¶å®‰è£…åˆ°æœ¬åœ°Mavenä»“åº“ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.5 Java VS PHP</p>
<p>ç»´åº¦	Java (Spring Boot)	PHP (Laravel)</p>
<p>æ‰§è¡Œæ–¹å¼	ç¼–è¯‘ + å¸¸é©»å†…å­˜	è§£é‡Š + è¯·æ±‚å³é”€æ¯</p>
<p>æ€§èƒ½	è¿è¡Œå¿«ï¼Œå¯åŠ¨æ…¢ï¼Œå¸¸é©»å†…å­˜çš„&quot;é•¿æœŸå·¥ä½œè€…&quot;ï¼ˆç¼–è¯‘å‹ + JVM + JITï¼ŒJavaå¿«æ˜¯å› ä¸ºæœ‰JITï¼‰ï¼Œå¤„ç†é«˜å¹¶å‘ã€‚	å¯åŠ¨å¿«ï¼Œè¿è¡Œç›¸å¯¹æ…¢ã€‚è¯·æ±‚å³é”€æ¯çš„&quot;ä¸´æ—¶å·¥&quot;ï¼ˆè§£é‡Šå‹ + CGIï¼‰</p>
<p>ç±»å‹ç³»ç»Ÿ	é™æ€å¼ºç±»å‹	åŠ¨æ€å¼±ç±»å‹</p>
<p>å¹¶å‘å¤„ç†	å¼ºå¤§ï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œå¯ä»¥å…±äº«æ•°æ®åº“è¿æ¥æ± 	æœ‰é™ï¼ˆå¤šè¿›ç¨‹ï¼‰ï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹è¿æ¥ï¼Œ1000ä¸ªå¹¶å‘åˆ™å¯èƒ½åˆ›å»º 1000 ä¸ªæ•°æ®åº“è¿æ¥ã€‚ç°åœ¨æœ‰äº†Workerman/Swooleä¹Ÿå¯ä»¥å¸¸é©»å†…å­˜äº†ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<p>ï¼ˆ1ï¼‰å¤„ç†ç¬¬ä¸€ä¸ªè¯·æ±‚</p>
<p>Javaï¼š</p>
<p>1. ç”¨æˆ·è®¿é—® /api/users</p>
<p>2. JVM å·²è¿è¡Œï¼Œç›´æ¥è°ƒç”¨å·²æœ‰å¯¹è±¡</p>
<p>3. å“åº”æ—¶é—´ï¼š50ms</p>
<div class="gap"></div>
<p>PHPï¼š</p>
<p>1. ç”¨æˆ·è®¿é—® /api/users</p>
<p>2. Nginx æ”¶åˆ°è¯·æ±‚ â†’ å¯åŠ¨ PHP-FPM è¿›ç¨‹</p>
<p>3. PHP è§£é‡Šå™¨è¯»å–æ–‡ä»¶ â†’ æ‰§è¡Œä»£ç </p>
<p>4. å“åº”æ—¶é—´ï¼š100ms</p>
<div class="gap"></div>
<div class="gap"></div>
<p>ï¼ˆ2ï¼‰å¤„ç†ç¬¬ 1000 ä¸ªè¯·æ±‚</p>
<p>Javaï¼š</p>
<p>1. ç”¨æˆ·è®¿é—® /api/users</p>
<p>2. ç›´æ¥è°ƒç”¨å†…å­˜ä¸­çš„å¯¹è±¡</p>
<p>3. å“åº”æ—¶é—´ï¼š20msï¼ˆJIT ä¼˜åŒ–åæ›´å¿«ï¼‰</p>
<h2 id="h-4" class="heading level-1">4. å†…å­˜ï¼šè¿˜æ˜¯ 300MB</h2>
<div class="gap"></div>
<p>PHPï¼š</p>
<p>1. ç”¨æˆ·è®¿é—® /api/users</p>
<p>2. å¯èƒ½åˆ›å»ºæ–°çš„ PHP è¿›ç¨‹</p>
<p>3. é‡æ–°è§£é‡Šæ‰§è¡Œ</p>
<p>4. å“åº”æ—¶é—´ï¼š100msï¼ˆä¸ç¬¬ä¸€æ¬¡å·®ä¸å¤šï¼‰</p>
<p>5. å†…å­˜ï¼šç´¯ç§¯ä½¿ç”¨ï¼Œä½†æ¯ä¸ªè¯·æ±‚åé‡Šæ”¾</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.6 JVM ï¼ˆJava Virtual Machineï¼‰ æ˜¯ Java çš„è™šæ‹Ÿè®¡ç®—æœºï¼Œ</p>
<p>æºä»£ç  (.java)</p>
<pre><code>    â†“ ç¼–è¯‘</code></pre>
<p>å­—èŠ‚ç  (.class)      â† è¿™æ˜¯å¹³å°æ— å…³çš„</p>
<pre><code>    â†“</code></pre>
<p>JVM åŠ è½½å­—èŠ‚ç </p>
<pre><code>    â†“</code></pre>
<p>JVM è§£é‡Šæ‰§è¡Œ</p>
<pre><code>    â†“</code></pre>
<p>æ“ä½œç³»ç»Ÿ + CPU</p>
<div class="gap"></div>
<p>JVM è®©javaåœ¨å„ç§ç¯å¢ƒéƒ½èƒ½è·‘èµ·æ¥ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>// JVM å†…å­˜ç»“æ„ï¼ˆç®€åŒ–ï¼‰</p>
<p>JVM å†…å­˜åŒºåŸŸï¼š</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚         æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰         â”‚ â† å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± </p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚         å †ï¼ˆHeapï¼‰                   â”‚ â† æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™é‡Œï¼ˆGC ç®¡ç†ï¼‰</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚         æ ˆï¼ˆStackï¼‰                  â”‚ â† çº¿ç¨‹ç§æœ‰ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚       ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰        â”‚ â† å½“å‰æ‰§è¡Œä½ç½®</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚   æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰   â”‚ â† è°ƒç”¨æœ¬åœ°æ–¹æ³•</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<div class="gap"></div>
<p>// å¯åŠ¨ JVM æ—¶çš„é‡è¦å‚æ•°</p>
<p>java -Xms512m    # åˆå§‹å †å¤§å°</p>
<pre><code>     -Xmx1024m   # æœ€å¤§å †å¤§å°
     -Xss256k    # æ¯ä¸ªçº¿ç¨‹æ ˆå¤§å°
     -jar app.jar ï¼ˆapp.jar æ–‡ä»¶é‡Œ ç¼–è¯‘åç”Ÿæˆçš„.class æ–‡ä»¶æ˜¯æ ¸å¿ƒï¼‰</code></pre>
<p>7.7 JITï¼šè®© Java é£èµ·æ¥çš„å…³é”®</p>
<p>JITï¼ˆJust-In-Time Compilationï¼Œå³æ—¶ç¼–è¯‘ï¼‰ æ˜¯ JVM çš„æ€§èƒ½åŠ é€Ÿå™¨</p>
<div class="gap"></div>
<div class="gap"></div>
<p>æ²¡æœ‰ JIT æ—¶ï¼š</p>
<p>Java å­—èŠ‚ç  â†’ JVM è§£é‡Šæ‰§è¡Œ â†’ æœ‰ç‚¹æ…¢</p>
<div class="gap"></div>
<p>æœ‰ JIT æ—¶ï¼š</p>
<p>çƒ­ç‚¹ä»£ç ï¼ˆç»å¸¸æ‰§è¡Œçš„ä»£ç ï¼‰ â†’ JIT ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç  â†’ ç›´æ¥æ‰§è¡Œ â†’ å¾ˆå¿«ï¼</p>
<div class="gap"></div>
<div class="gap"></div>
<p>JIT å°±åƒç»™ Java è£…äº†ä¸ªè®°å¿†èŠ¯ç‰‡ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶è®°ä½æ€ä¹ˆåšï¼Œä»¥åç›´æ¥ç…§åšï¼Œä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°æƒ³ï¼ˆè§£é‡Šï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Java è¶Šè·‘è¶Šå¿«ï¼Œè€Œ PHPï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰æ¯æ¬¡éƒ½è¦é‡æ–°æƒ³ã€‚</p>
<div class="gap"></div>
<p>7.8 éƒ¨ç½²javaåˆ°ç”Ÿäº§ç¯å¢ƒ</p>
<div class="gap"></div>
<p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯æ‰§è¡ŒJARï¼ˆæœ€å¸¸è§ï¼‰</p>
<p>1ï¼‰æ‰“åŒ…</p>
<p># Maven</p>
<p>mvn clean package</p>
<p># è¾“å‡ºï¼štarget/ä½ çš„åº”ç”¨å.jar</p>
<div class="gap"></div>
<p># Gradle</p>
<p>./gradlew bootJar</p>
<p># è¾“å‡ºï¼šbuild/libs/ä½ çš„åº”ç”¨å.jar</p>
<div class="gap"></div>
<p>2ï¼‰ä¼ è¾“ï¼šå°†JARæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
<div class="gap"></div>
<p>3ï¼‰è¿è¡Œï¼šä½¿ç”¨java -jar</p>
<p># æœ€åŸºæœ¬å¯åŠ¨</p>
<p>java -jar /opt/app/ä½ çš„åº”ç”¨å.jar</p>
<div class="gap"></div>
<p># ç”Ÿäº§ç¯å¢ƒæ¨èï¼šæŒ‡å®šå†…å­˜ã€GCç­‰å‚æ•°ï¼Œå¹¶åœ¨åå°è¿è¡Œ</p>
<p>nohup java -Xms512m -Xmx1024m -XX:+UseG1GC -jar /opt/app/ä½ çš„åº”ç”¨å.jar \</p>
<pre><code>     --server.port=8080 \
     &gt; /opt/app/app.log 2&gt;&amp;1 &amp;</code></pre>
<p>4ï¼‰é…ç½®nginxè¿›è¡Œåå‘ä»£ç†åˆ°8080ã€‚</p>
<div class="gap"></div>
<p>æ–¹æ³•äºŒï¼š</p>
<p>ä½¿ç”¨ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨ï¼ˆå¦‚ systemd æˆ– supervisorï¼‰æ¥ç®¡ç†Javaè¿›ç¨‹ï¼Œå®ç°å¼€æœºè‡ªå¯ã€æ•…éšœé‡å¯ã€æ—¥å¿—è½®è½¬ç­‰</p>
<div class="gap"></div>
<p>æ–¹æ³•ä¸‰ï¼š</p>
<p>Docker</p>
<div class="gap"></div>
<p>7.9 Java å¼‚å¸¸</p>
<p>Java ä¸­æœ‰ä¸¤ç§å¼‚å¸¸ï¼š</p>
<div class="gap"></div>
<p>å—æ£€å¼‚å¸¸ (Checked Exception)ï¼šå¿…é¡»è¢«æ•è·æˆ–å£°æ˜æŠ›å‡º</p>
<p>éå—æ£€å¼‚å¸¸ (Runtime Exception)ï¼šå¯ä»¥ä¸å¤„ç†</p>
<div class="gap"></div>
<p>7.10 Spring ä¾èµ–æ³¨å…¥çš„æ³¨è§£</p>
<p>// 1. @Component - é€šç”¨ç»„ä»¶</p>
<pre><code>@Component  // æœ€é€šç”¨ï¼Œä»»ä½•ç±»éƒ½å¯ä»¥ç”¨</code></pre>
<pre><code>public class MyService { ... }</code></pre>
<div class="gap"></div>
<p>// 2. @Service - ä¸šåŠ¡é€»è¾‘å±‚</p>
<pre><code>@Service    // è¯­ä¹‰åŒ–ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸šåŠ¡æœåŠ¡</code></pre>
<pre><code>public class UserService { ... }</code></pre>
<div class="gap"></div>
<p>// 3. @Repository - æ•°æ®è®¿é—®å±‚  </p>
<pre><code>@Repository // è¯­ä¹‰åŒ–ï¼Œè¡¨ç¤ºè¿™æ˜¯æ•°æ®è®¿é—®ç»„ä»¶</code></pre>
<pre><code>public class UserRepository { ... }</code></pre>
<div class="gap"></div>
<p>// 4. @Controller - Webæ§åˆ¶å™¨å±‚</p>
<pre><code>@Controller // å¤„ç†HTTPè¯·æ±‚</code></pre>
<pre><code>public class UserController { ... }</code></pre>
<div class="gap"></div>
<p>// 5. @RestController = @Controller + @ResponseBody</p>
<pre><code>@RestController // REST APIæ§åˆ¶å™¨</code></pre>
<pre><code>public class ApiController { ... }</code></pre>
<div class="gap"></div>
<p>// 6. @Configuration - é…ç½®ç±»</p>
<pre><code>@Configuration // åŒ…å«@Beanæ–¹æ³•çš„é…ç½®ç±»</code></pre>
<pre><code>public class AppConfig { ... }</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>æ³¨è§£	ç”¨é€”	ç‰¹æ®Šå¤„ç†	ç¤ºä¾‹</p>
<pre><code>@Component	é€šç”¨ç»„ä»¶	æ— 	å·¥å…·ç±»ã€æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨</code></pre>
<pre><code>@Service	ä¸šåŠ¡æœåŠ¡	äº‹åŠ¡ä»£ç†	UserService, OrderService</code></pre>
<pre><code>@Repository	æ•°æ®è®¿é—®	å¼‚å¸¸è½¬æ¢	UserRepository, ProductRepository</code></pre>
<pre><code>@Controller	Webæ§åˆ¶å™¨	è¯·æ±‚æ˜ å°„	UserControllerï¼ˆä¼ ç»Ÿè¿”å›è§†å›¾çš„ MVC æ§åˆ¶å™¨ï¼‰</code></pre>
<pre><code>@RestController	RESTæ§åˆ¶å™¨	è‡ªåŠ¨@ResponseBody	ApiControllerï¼ˆRESTful APIï¼‰</code></pre>
<pre><code>@Configuration	é…ç½®ç±»	ä»£ç†æ¨¡å¼	SecurityConfig, WebConfig</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>7.11 </p>
<p>è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯</p>
<div class="gap"></div>
<p>æ–¹å¼ä¸€ï¼šRequestå±æ€§ï¼ˆHttpServletRequestï¼‰</p>
<p>ä¼˜ç‚¹ï¼š</p>
<p>âœ… å®ç°ç®€å•ç›´æ¥</p>
<p>âœ… æ— éœ€é¢å¤–ä¾èµ–</p>
<p>âœ… è‡ªåŠ¨éšè¯·æ±‚é“¾ä¼ é€’</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>âŒ åªåœ¨å½“å‰è¯·æ±‚å‘¨æœŸå†…æœ‰æ•ˆ</p>
<p>âŒ ä¸é€‚åˆå¼‚æ­¥æ“ä½œï¼Œå› ä¸ºRequest å¯¹è±¡åªåœ¨å½“å‰è¯·æ±‚çº¿ç¨‹ä¸­æœ‰æ•ˆï¼Œå¦‚æœæœ‰å¼‚æ­¥åˆ›å»ºäº†æ–°çº¿ç¨‹ï¼Œåˆ™è·å–ä¸åˆ°äº†ã€‚</p>
<div class="gap"></div>
<p>æ–¹å¼äºŒï¼šSpring Securityï¼ˆSecurityContextï¼‰</p>
<p>ä¼˜ç‚¹ï¼š</p>
<p>âœ… Spring å®˜æ–¹æ¨èæ–¹æ¡ˆ</p>
<p>âœ… æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥ä»ä¸»çº¿ç¨‹æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯</p>
<p>âœ… åŠŸèƒ½å®Œæ•´ï¼ˆæƒé™ã€è§’è‰²ç®¡ç†ç­‰ï¼‰</p>
<p>âœ… ç”Ÿæ€å®Œå–„</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>âŒ éœ€è¦å¼•å…¥ Spring Security ä¾èµ–</p>
<p>âŒ å­¦ä¹ æˆæœ¬ç¨é«˜</p>
<p>âŒ éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.12 è¿‡æ»¤å™¨ vs æ‹¦æˆªå™¨ vs åˆ‡é¢</p>
<p>è¯·æ±‚æµç¨‹ï¼š</p>
<p>å®¢æˆ·ç«¯</p>
<pre><code>    â†“</code></pre>
<p>è¿‡æ»¤å™¨ (Filter)          â† æœ€æ—©ï¼ŒServlet å±‚é¢</p>
<pre><code>    â†“</code></pre>
<p>DispatcherServlet</p>
<pre><code>    â†“</code></pre>
<p>æ‹¦æˆªå™¨ (Interceptor)      â† Spring MVC å±‚é¢</p>
<pre><code>    â†“</code></pre>
<p>Controller</p>
<pre><code>    â†“</code></pre>
<p>åˆ‡é¢ (Aspect)            â† æ–¹æ³•çº§åˆ«ï¼Œæœ€çµæ´»</p>
<pre><code>    â†“</code></pre>
<p>Serviceä¸šåŠ¡é€»è¾‘</p>
<div class="gap"></div>
<div class="gap"></div>
<p>7.13 Request Body æ—¥å¿—è®°å½• - å®ç°è¯´æ˜</p>
<p>a. é—®é¢˜ï¼šä¹‹å‰ log.info(&quot;Request Body: {}&quot;, request.getAttribute(&quot;requestBody&quot;)) è¿”å› null</p>
<div class="gap"></div>
<p>b. åŸå› ï¼šHTTP Request Body åªèƒ½è¯»å–ä¸€æ¬¡ï¼š</p>
<div class="gap"></div>
<p>Servlet çš„ InputStream è¯»å–åå°±å…³é—­äº†</p>
<p>Spring MVC åœ¨å‚æ•°ç»‘å®šæ—¶å·²ç»è¯»å–äº† Body</p>
<p>åœ¨ AOP åˆ‡é¢ä¸­å†æ¬¡è¯»å–æ—¶ï¼Œæµå·²ç»ç©ºäº†</p>
<div class="gap"></div>
<p>c. è§£å†³æ–¹æ¡ˆ</p>
<p>RepeatedlyReadRequestWrapperï¼ˆRequest åŒ…è£…å™¨ï¼‰</p>
<p>åŸå§‹ Request</p>
<pre><code>    â†“</code></pre>
<p>è¯»å– InputStream å¹¶ç¼“å­˜åˆ° byte[]</p>
<pre><code>    â†“</code></pre>
<p>é‡å†™ getInputStream() æ–¹æ³•</p>
<pre><code>    â†“</code></pre>
<p>æ¯æ¬¡è°ƒç”¨æ—¶ä»ç¼“å­˜çš„ byte[] åˆ›å»ºæ–°çš„æµ</p>
<pre><code>    â†“</code></pre>
<p>å®ç°å¯é‡å¤è¯»å–</p>
<div class="gap"></div>
<p>d. RequestBodyCacheFilterï¼ˆè¿‡æ»¤å™¨ï¼‰</p>
<div class="gap"></div>
<p>ä½œç”¨ï¼š</p>
<div class="gap"></div>
<p>æ‹¦æˆªæ‰€æœ‰ HTTP è¯·æ±‚</p>
<p>å¯¹ POST/PUT/PATCH è¯·æ±‚åŒ…è£…æˆå¯é‡å¤è¯»å–çš„ Request</p>
<p>å°† Body å†…å®¹è®¾ç½®åˆ° request å±æ€§ä¸­</p>
<div class="gap"></div>
<p>7.14 Spring Security</p>
<p>åŸºäºURLï¼Œå¯¹äºæ¥å£çš„è®¿é—®æ§åˆ¶ï¼šä¸»è¦æ˜¯é€šè¿‡ Servlet Filter é“¾ å®ç°çš„ã€‚è¿™æ˜¯ä½ å¿…é¡»ç†è§£å’Œé…ç½®çš„åŸºç¡€ã€‚</p>
<pre><code>@Override</code></pre>
<pre><code>protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
        .antMatchers(&quot;/api/admin/**&quot;).hasRole(&quot;ADMIN&quot;) // /api/admin/ ä¸‹çš„æ¥å£éœ€è¦ADMINè§’è‰²
        .antMatchers(&quot;/api/user/**&quot;).hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;) // éœ€è¦USERæˆ–ADMINè§’è‰²
        .antMatchers(&quot;/api/public/**&quot;).permitAll() // å…¬å¼€è®¿é—®
        .anyRequest().authenticated() // å…¶ä»–æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦è®¤è¯
        .and()
        .addFilterBefore(new JwtTokenFilter(), UsernamePasswordAuthenticationFilter.class); // æ·»åŠ JWTè¿‡æ»¤å™¨
}</code></pre>
<div class="gap"></div>
<p>åŸºäºæ–¹æ³•ï¼Œå¯¹äºæ›´å¤æ‚ã€åŸºäºä¸šåŠ¡é€»è¾‘çš„æƒé™åˆ¤æ–­ï¼šåº”ä½¿ç”¨åŸºäº Spring AOP çš„ @PreAuthorize ç­‰æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦èƒ½åˆ é™¤â€œè‡ªå·±å‘å¸ƒçš„â€æ–‡ç« ï¼Œè¿™ç§ä¾èµ–æ•°æ®èº«ä»½çš„æƒé™ï¼Œéå¸¸é€‚åˆç”¨ @PreAuthorize(â€œ@permissionService.checkOwnership(#id, principal)â€) æ¥å®ç°</p>
<div class="gap"></div>
<pre><code>@RestController</code></pre>
<pre><code>@RequestMapping(&quot;/api/products&quot;)</code></pre>
<pre><code>public class ProductController {
    @DeleteMapping(&quot;/{id}&quot;)
    @PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;) or @permissionService.canDeleteProduct(#id, principal)&quot;) // æ”¯æŒSpELè¡¨è¾¾å¼ï¼Œå¯è°ƒç”¨è‡ªå®šä¹‰é€»è¾‘
    public ResponseEntity&lt;?&gt; deleteProduct(@PathVariable Long id) {
        // åˆ é™¤å•†å“é€»è¾‘
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
                </main>
            </div>
        </div>
        
        <!-- æ‹›è˜ç¯‡ -->
        <div class="tab-panel">
            <div class="layout">
                <aside class="sidebar">
                    <div class="sidebar-title">ğŸ“‘ ç›®å½•å¯¼èˆª</div>
                    <button class="mobile-toc-toggle" onclick="toggleToc(this)">
                        <span>ğŸ“‘ ç›®å½•å¯¼èˆª</span>
                        <span class="toggle-icon">â–¼</span>
                    </button>
                    <div class="toc-tree">
        <a href="#h-1" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">1</span>
            <span class="toc-text">Spring Bootå¯åŠ¨æµç¨‹</span>
        </a>
        <a href="#h-2" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">2</span>
            <span class="toc-text">è¯·æ±‚å‚æ•°å¤„ç†</span>
        </a>
        <a href="#h-3" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">3</span>
            <span class="toc-text">æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å¯¹æ¯”</span>
        </a>
        <a href="#h-4" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">4</span>
            <span class="toc-text">Spring Data JPA</span>
        </a>
        <a href="#h-5" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">5</span>
            <span class="toc-text">äº‹åŠ¡ç®¡ç†</span>
        </a>
        <a href="#h-6" class="toc-link level-1" style="padding-left: 0px;">
            <span class="toc-num">6</span>
            <span class="toc-text">æ•°æ®åº“è¿æ¥æ± </span>
        </a></div>
                </aside>
                <main class="main">
                    <p>ç®€å†ï¼š</p>
<p>ä½¿ç”¨ Spring Boot å¼€å‘ REST APIï¼Œ</p>
<p>å®ç°åŸºäº JWT çš„ç™»å½•é‰´æƒï¼Œ</p>
<p>é€šè¿‡ AOP å¤„ç†äº‹åŠ¡ä¸æ—¥å¿—</p>
<div class="gap"></div>
<div class="gap"></div>
<p>ã€èƒ½åŠ›è¦æ±‚ã€‘ï¼š</p>
<p>1ã€JavaåŸºç¡€æ‰å®ï¼Œç†è§£IOã€å¤šçº¿ç¨‹ã€é›†åˆç­‰åŸºç¡€æ¶æ„ï¼Œç†Ÿæ‚‰JVMåŸç†ï¼Œç†Ÿæ‚‰å¸¸ç”¨çš„Javaå¼€æºæ¡†æ¶ï¼Œå¯¹ä½¿ç”¨è¿‡çš„æ¡†æ¶èƒ½äº†è§£åˆ°åŸç†å’Œæœºåˆ¶ï¼Œç†Ÿæ‚‰springbootï¼Œspringcloudç­‰å¸¸ç”¨å¼€æºæ¡†æ¶ï¼›</p>
<p>2ã€äº†è§£äº’è”ç½‘ç³»ç»Ÿçš„æ¶æ„ï¼Œ2å¹´ä»¥ä¸Šçš„é«˜å¯ç”¨ã€åˆ†å¸ƒå¼å¤§å‹ç³»ç»Ÿæ¶æ„å’Œå¼€å‘ç»éªŒï¼Œä¸°å¯Œçš„çº¿ä¸Šè¿ç»´ç»éªŒï¼Œç†Ÿæ‚‰ç¼“å­˜ã€æ¶ˆæ¯ç­‰æœºåˆ¶ï¼Œç†Ÿæ‚‰å¼€æºä¸­é—´ä»¶çš„ä½¿ç”¨ï¼Œäº†è§£å…¶åŸç†å’Œæœºåˆ¶ã€‚</p>
<p>3ã€æœ‰é«˜å¹¶å‘ã€é«˜å¯ç”¨æ€§ç³»ç»Ÿè®¾è®¡ä¸å¼€å‘çš„ç»éªŒï¼Œæœ‰æ€§èƒ½è°ƒä¼˜çš„ç»éªŒï¼ŒæŒæ¡å¤šçº¿ç¨‹åŠé«˜æ€§èƒ½çš„è®¾è®¡ä¸ç¼–ç åŠæ€§èƒ½è°ƒä¼˜ï¼›æœ‰é«˜å¹¶å‘åº”ç”¨å¼€å‘ç»éªŒã€‚</p>
<p>4ã€å¯¹æ•°æ®æŠ½è±¡ã€é¢†åŸŸå»ºæ¨¡ç­‰æœ‰ç›¸å…³çš„å·¥ä½œç»éªŒï¼Œæœ‰å¤§æ•°æ®å¤„ç†åŠç®—æ³•ç»éªŒè€…ä¼˜å…ˆã€‚ï¼ˆHadoop/Spark/Flink/Kafkaç­‰å¤§æ•°æ®ä¸æµå¤„ç†æŠ€æœ¯ï¼‰</p>
<p>5ã€æŒæ¡Linux æ“ä½œç³»ç»Ÿå’Œå¤§å‹æ•°æ®åº“ï¼ˆOracleã€MySqlï¼‰ã€å¯¹sqlä¼˜åŒ–æœ‰ä¸°å¯Œçš„ç»éªŒã€‚</p>
<p>6ã€å…·å¤‡è‰¯å¥½çš„è®¾è®¡é€šç”¨æ¡†æ¶åŠæ¨¡å—çš„èƒ½åŠ›ã€‚å…·å¤‡è‰¯å¥½çš„ç³»ç»Ÿåˆ†æèƒ½åŠ›ã€æŠ½è±¡èƒ½åŠ›ï¼Œæ“…é•¿åˆ†æå¤æ‚é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>æ ¹æ®ä¸Šé¢çš„è¦æ±‚ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<h2 id="h-1" class="heading level-1">1. Spring Bootå¯åŠ¨æµç¨‹</h2>
<p>ä»SpringApplication.run()å¼€å§‹çš„å…³é”®æ­¥éª¤ï¼ˆåŠ è½½é…ç½®ã€åˆ›å»ºä¸Šä¸‹æ–‡ã€åˆ·æ–°ä¸Šä¸‹æ–‡ç­‰ï¼‰ã€‚</p>
<div class="gap"></div>
<p>å†…åµŒWebæœåŠ¡å™¨ï¼ˆå¦‚Tomcatï¼‰çš„å¯åŠ¨è¿‡ç¨‹ã€‚</p>
<div class="gap"></div>
<h2 id="h-2" class="heading level-1">2. è¯·æ±‚å‚æ•°å¤„ç†</h2>
<pre><code>@RequestParamã€@RequestBodyã€@Validæ ¡éªŒå‚æ•°</code></pre>
<div class="gap"></div>
<p>å…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆ@ControllerAdviceå’Œ@ExceptionHandlerï¼‰ã€‚</p>
<pre><code>@ControllerAdviceï¼šå…¨å±€å¼‚å¸¸å¤„ç†å’Œå…¨å±€æ•°æ®ç»‘å®šçš„æ³¨è§£ã€‚</code></pre>
<pre><code>@ExceptionHandler(å¼‚å¸¸ç±».class)ï¼Œå¤„ç†æŒ‡å®šç±»å‹çš„å¼‚å¸¸ã€‚</code></pre>
<div class="gap"></div>
<h2 id="h-3" class="heading level-1">3. æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å¯¹æ¯”</h2>
<div class="gap"></div>
<p>ç»´åº¦	è¿‡æ»¤å™¨ï¼ˆFilterï¼‰	æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</p>
<p>æ‰€å±è§„èŒƒ	Servletè§„èŒƒï¼ˆjavax.servletï¼‰	Spring MVCæ¡†æ¶ï¼ˆorg.springframework.web.servletï¼‰</p>
<p>ä½œç”¨èŒƒå›´	æ‰€æœ‰Webèµ„æºï¼ˆServletã€JSPã€é™æ€èµ„æºï¼‰	åªé’ˆå¯¹Spring MVCç®¡ç†çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰</p>
<p>ä¾èµ–	ä¸ä¾èµ–Springæ¡†æ¶ï¼Œå¯åœ¨ä»»ä½•Java Webåº”ç”¨ä¸­ä½¿ç”¨	ä¾èµ–Spring MVCæ¡†æ¶</p>
<p>æ‰§è¡Œæ—¶æœº	åœ¨è¯·æ±‚è¿›å…¥Servletä¹‹å‰ï¼Œå“åº”ç¦»å¼€Servletä¹‹å	åœ¨DispatcherServletå¤„ç†è¯·æ±‚å‰å</p>
<p>è·å–Spring Bean	æ— æ³•ç›´æ¥æ³¨å…¥Spring Beanï¼ˆéœ€é€šè¿‡å…¶ä»–æ–¹å¼ï¼‰	å¯ç›´æ¥ä½¿ç”¨Springä¾èµ–æ³¨å…¥</p>
<div class="gap"></div>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<p>HTTP Request â†’ Tomcat â†’ Filter Chain â†’ DispatcherServlet â†’ Interceptor Chain â†’ Controller</p>
<pre><code>           â†“                                                      â†“</code></pre>
<p>HTTP Response â† Tomcat â† Filter Chain â† DispatcherServlet â† Interceptor Chain â† Controller</p>
<div class="gap"></div>
<p>DispatcherServletè´Ÿè´£ï¼šå°†æ¥æ”¶åˆ°çš„HTTPè¯·æ±‚ï¼Œå‘ç»™ç›¸åº”çš„æ§åˆ¶å™¨å¤„ç†</p>
<div class="gap"></div>
<p>1) Filterï¼šIPé»‘ç™½åå• â†’ å­—ç¬¦ç¼–ç è®¾ç½® â†’ CORSå¤„ç†</p>
<p>2) Interceptorï¼šç™»å½•éªŒè¯ â†’ æƒé™æ ¡éªŒ â†’ æ¥å£æ—¥å¿—</p>
<p>3) AOPï¼šä¸šåŠ¡å±‚æ—¥å¿— â†’ äº‹åŠ¡ç®¡ç† â†’ æ€§èƒ½ç›‘æ§</p>
<div class="gap"></div>
<div class="gap"></div>
<p>å¸¸è§é¢è¯•é—®é¢˜</p>
<p>1ï¼‰è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿ</p>
<div class="gap"></div>
<p>è¿‡æ»¤å™¨åœ¨DispatcherServletä¹‹å‰æ‰§è¡Œï¼Œæ‹¦æˆªå™¨åœ¨DispatcherServletä¹‹åæ‰§è¡Œ</p>
<div class="gap"></div>
<p>å¤šä¸ªè¿‡æ»¤å™¨æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œï¼Œå¤šä¸ªæ‹¦æˆªå™¨æŒ‰é…ç½®é¡ºåºæ‰§è¡Œ</p>
<div class="gap"></div>
<p>2ï¼‰è¿‡æ»¤å™¨ä¸­å¯ä»¥æ³¨å…¥Spring Beanå—ï¼Ÿ</p>
<div class="gap"></div>
<p>ç›´æ¥ä½¿ç”¨@Autowiredæ— æ•ˆï¼Œéœ€è¦é€šè¿‡WebApplicationContextUtilsè·å–</p>
<div class="gap"></div>
<p>æˆ–ä½¿ç”¨Springçš„DelegatingFilterProxy</p>
<div class="gap"></div>
<p>3ï¼‰ä»€ä¹ˆæƒ…å†µä¸‹æ‹¦æˆªå™¨çš„postHandleæ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼Ÿ</p>
<div class="gap"></div>
<p>preHandleè¿”å›falseæ—¶</p>
<div class="gap"></div>
<p>ControlleræŠ›å‡ºå¼‚å¸¸ä¸”æœªè¢«@ControllerAdviceæ•è·æ—¶</p>
<div class="gap"></div>
<p>4ï¼‰å¦‚ä½•å…¨å±€æ•è·Controllerå¼‚å¸¸ï¼Ÿ</p>
<div class="gap"></div>
<p>ä½¿ç”¨@ControllerAdvice + @ExceptionHandlerï¼ˆåœ¨æ‹¦æˆªå™¨ä¹‹åæ‰§è¡Œï¼‰</p>
<div class="gap"></div>
<p>æ— æ³•åœ¨è¿‡æ»¤å™¨ä¸­æ•è·Controllerå¼‚å¸¸</p>
<div class="gap"></div>
<p>5ï¼‰å¦‚ä½•å¤„ç†é™æ€èµ„æºï¼Ÿ</p>
<div class="gap"></div>
<p>è¿‡æ»¤å™¨å¯ä»¥å¤„ç†æ‰€æœ‰é™æ€èµ„æº</p>
<div class="gap"></div>
<p>æ‹¦æˆªå™¨é»˜è®¤ä¸å¤„ç†é™æ€èµ„æºï¼Œéœ€é€šè¿‡é…ç½®æ’é™¤</p>
<div class="gap"></div>
<div class="gap"></div>
<h2 id="h-4" class="heading level-1">4. Spring Data JPA</h2>
<p>4.1 å…³è”å…³ç³»æ³¨è§£</p>
<p>ä¸€å¯¹ä¸€ï¼ˆOne-to-Oneï¼‰</p>
<div class="gap"></div>
<pre><code>@Entity</code></pre>
<pre><code>public class User {
    @Id
    private Long id;
    
    @OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;address_id&quot;, referencedColumnName = &quot;id&quot;)
    private Address address;  // ç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªåœ°å€
}</code></pre>
<div class="gap"></div>
<pre><code>@Entity</code></pre>
<pre><code>public class Address {
    @Id
    private Long id;
    
    @OneToOne(mappedBy = &quot;address&quot;)
    private User user;  // åœ°å€è¢«ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>ä¸€å¯¹å¤šï¼ˆOne-to-Manyï¼‰</p>
<pre><code>@Entity</code></pre>
<pre><code>public class Department {
    @Id
    private Long id;
    
    @OneToMany(mappedBy = &quot;department&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List&lt;Employee&gt; employees = new ArrayList&lt;&gt;();
    // mappedByè¡¨ç¤ºå…³ç³»ç”±Employeeç±»çš„departmentå±æ€§ç»´æŠ¤
}</code></pre>
<div class="gap"></div>
<pre><code>@Entity</code></pre>
<pre><code>public class Employee {
    @Id
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;dept_id&quot;)
    private Department department;  // å¤–é”®ç»´æŠ¤æ–¹
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>ä¸€å¯¹å¤šï¼ˆOne-to-Manyï¼‰</p>
<pre><code>@Entity</code></pre>
<pre><code>public class Department {
    @Id
    private Long id;
    
    @OneToMany(mappedBy = &quot;department&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)
    private List&lt;Employee&gt; employees = new ArrayList&lt;&gt;();
    // mappedByè¡¨ç¤ºå…³ç³»ç”±Employeeç±»çš„departmentå±æ€§ç»´æŠ¤
}</code></pre>
<div class="gap"></div>
<pre><code>@Entity</code></pre>
<pre><code>public class Employee {
    @Id
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;dept_id&quot;)
    private Department department;  // å¤–é”®ç»´æŠ¤æ–¹
}</code></pre>
<div class="gap"></div>
<p>4.2 æ–¹æ³•å‘½åè§„åˆ™æŸ¥è¯¢</p>
<p>findBy/readBy/queryBy/getBy/countBy/deleteBy + å±æ€§ + æ¡ä»¶</p>
<div class="gap"></div>
<p>// 1. ç®€å•æ¡ä»¶æŸ¥è¯¢</p>
<p>User findByUsername(String username);</p>
<p>List&lt;User&gt; findByEmail(String email);</p>
<p>User findByUsernameAndEmail(String username, String email);</p>
<div class="gap"></div>
<p>// 2. æ¯”è¾ƒæŸ¥è¯¢</p>
<p>List&lt;User&gt; findByAgeGreaterThan(int age);</p>
<p>List&lt;User&gt; findByAgeLessThanEqual(int age);  // å°äºç­‰äº</p>
<p>List&lt;User&gt; findByAgeBetween(int min, int max);</p>
<p>List&lt;User&gt; findByAgeNotBetween(int start, int end);  // ä¸åœ¨åŒºé—´å†…</p>
<p>List&lt;User&gt; findByAgeIn(Collection&lt;Integer&gt; ages);</p>
<p>List&lt;User&gt; findByAgeNotIn(Collection&lt;Integer&gt; ages);</p>
<p>List&lt;User&gt; findByCreateTimeAfter(Date date);       // åˆ›å»ºæ—¶é—´æ™šäºæŒ‡å®šæ—¶é—´</p>
<p>List&lt;User&gt; findByCreateTimeBefore(Date date);      // åˆ›å»ºæ—¶é—´æ—©äºæŒ‡å®šæ—¶é—´</p>
<div class="gap"></div>
<p>// 3. æ¨¡ç³ŠæŸ¥è¯¢</p>
<p>List&lt;User&gt; findByUsernameContaining(String keyword);</p>
<p>List&lt;User&gt; findByUsernameLike(String pattern);  // %keyword%</p>
<p>List&lt;User&gt; findByUsernameStartingWith(String prefix);</p>
<p>List&lt;User&gt; findByUsernameEndingWith(String suffix);</p>
<div class="gap"></div>
<p>// 4. æ’åºæŸ¥è¯¢</p>
<p>List&lt;User&gt; findByAgeOrderByCreateTimeDesc(int age);</p>
<p>List&lt;User&gt; findByStatusOrderByUsernameAscCreateTimeDesc(UserStatus status);</p>
<div class="gap"></div>
<p>// 5. ç»Ÿè®¡æŸ¥è¯¢</p>
<p>long countByStatus(UserStatus status);</p>
<p>boolean existsByEmail(String email);</p>
<p>int deleteByStatus(UserStatus status);</p>
<div class="gap"></div>
<p>// 6. å…³è”æŸ¥è¯¢</p>
<p>List&lt;User&gt; findByDepartmentName(String deptName);</p>
<p>List&lt;User&gt; findByDepartment_Id(Long deptId);  // ä½¿ç”¨ä¸‹åˆ’çº¿è®¿é—®å…³è”å¯¹è±¡å±æ€§</p>
<div class="gap"></div>
<p>// ç©ºå€¼æ£€æŸ¥</p>
<p>List&lt;User&gt; findByEmailIsNull();      // emailä¸ºNULL</p>
<p>List&lt;User&gt; findByEmailIsNotNull();   // emailä¸ä¸ºNULL</p>
<div class="gap"></div>
<p>// ç»“åˆå…¶ä»–æ¡ä»¶</p>
<p>List&lt;User&gt; findByEmailIsNotNullAndStatus(UserStatus status);</p>
<div class="gap"></div>
<p>4.3 @Queryæ³¨è§£æŸ¥è¯¢</p>
<p>JPQLæŸ¥è¯¢ï¼ˆé¢å‘å®ä½“ï¼‰</p>
<div class="gap"></div>
<pre><code>    @Query(&quot;SELECT u FROM User u WHERE u.username = :name OR u.email = :email&quot;)</code></pre>
<pre><code>    User findByNameOrEmail(@Param(&quot;name&quot;) String username, @Param(&quot;email&quot;) String email);</code></pre>
<p>åŸç”ŸSQLæŸ¥è¯¢ï¼š</p>
<pre><code>    @Query(value = &quot;SELECT * FROM users u WHERE u.age &gt; :age&quot;, nativeQuery = true)</code></pre>
<pre><code>    List&lt;User&gt; findUsersOlderThan(@Param(&quot;age&quot;) int age);</code></pre>
<h2 id="h-5" class="heading level-1">5. äº‹åŠ¡ç®¡ç†</h2>
<div class="gap"></div>
<p>5.1 @Transactionalçš„å·¥ä½œåŸç†</p>
<p>åº•å±‚å®ç° - AOPä»£ç†ï¼Œæ‰§è¡Œæµç¨‹ï¼š</p>
<div class="gap"></div>
<p>1ï¼‰ä»£ç†åˆ›å»ºï¼šSpringå¯åŠ¨æ—¶ï¼Œä¸ºæ ‡æ³¨@Transactionalçš„ç±»ç”ŸæˆåŠ¨æ€ä»£ç†ï¼ˆJDKåŠ¨æ€ä»£ç†æˆ–CGLIBï¼‰</p>
<p>2ï¼‰æ‹¦æˆªæ‰§è¡Œï¼šè°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»£ç†å…ˆæ‰§è¡Œäº‹åŠ¡ç®¡ç†é€»è¾‘</p>
<div class="gap"></div>
<p>3ï¼‰äº‹åŠ¡ç®¡ç†ï¼š</p>
<pre><code>    å¼€å¯äº‹åŠ¡ï¼ˆè·å–æ•°æ®åº“è¿æ¥ï¼Œè®¾ç½®autocommit=falseï¼‰
    æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
    æäº¤äº‹åŠ¡æˆ–å›æ»šäº‹åŠ¡</code></pre>
<p>4ï¼‰å¼‚å¸¸å¤„ç†ï¼šé‡åˆ°RuntimeException/Erroræ—¶å›æ»šï¼Œæ­£å¸¸æ‰§è¡Œåˆ™æäº¤</p>
<div class="gap"></div>
<div class="gap"></div>
<p>ç†è§£ä»£ç†ï¼š</p>
<p>è€æ¿ï¼ˆçœŸå®å¯¹è±¡ï¼‰ï¼šä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡ï¼ˆå¤„ç†é‡è¦äº‹åŠ¡ï¼‰</p>
<p>ç§˜ä¹¦ï¼ˆä»£ç†å¯¹è±¡ï¼‰ï¼šå¸®è€æ¿å¤„ç†æ‚åŠ¡ï¼ˆå®‰æ’ä¼šè®®ã€æ¥ç”µè¯ã€è®°å½•æ—¥ç¨‹ï¼‰</p>
<div class="gap"></div>
<div class="gap"></div>
<p>é™æ€ä»£ç†ï¼ˆæ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»ï¼‰ï¼šè¦ä¸ºæ¯ä¸ªç±»éƒ½å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œå·¥ä½œé‡å·¨å¤§ã€‚å¦‚æœè¦ä¸º100ä¸ªServiceæ·»åŠ äº‹åŠ¡ï¼Œè¦å†™100ä¸ªä»£ç†ç±»ã€‚</p>
<p>åŠ¨æ€ä»£ç†ï¼ˆè¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»ï¼‰ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°ä¸ºç›®æ ‡ç±»ç”Ÿæˆä»£ç†ç±»ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<pre><code>@Transactionalçš„å®ç°æœºåˆ¶æ˜¯ï¼šSpringåŸºäºAOPæ€æƒ³ï¼Œä½¿ç”¨TransactionInterceptorè¿™ä¸ªå…·ä½“çš„æ‹¦æˆªå™¨æ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚</code></pre>
<div class="gap"></div>
<p>è¯´å®ƒæ˜¯Aspectï¼šå› ä¸ºå®ƒéµå¾ªAOPçš„æ¨ªåˆ‡å…³æ³¨ç‚¹æ€æƒ³ï¼Œå°†äº‹åŠ¡é€»è¾‘ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼å®ç°ã€‚</p>
<div class="gap"></div>
<p>è¯´å®ƒæ˜¯Interceptorï¼šå› ä¸ºå…·ä½“å®ç°ç±»TransactionInterceptorå®ç°äº†AOPè”ç›Ÿæ ‡å‡†çš„MethodInterceptoræ¥å£ï¼Œä½¿ç”¨æ ‡å‡†çš„æ‹¦æˆªå™¨æ¨¡å¼åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•å‰åæ·»åŠ äº‹åŠ¡é€»è¾‘ã€‚</p>
<div class="gap"></div>
<p>æ›´å‡†ç¡®çš„è¯´æ³•ï¼š@Transactionalæ˜¯Spring AOPæ¡†æ¶çš„ä¸€ä¸ªå…·ä½“åº”ç”¨ï¼Œåº•å±‚é€šè¿‡TransactionInterceptoræ‹¦æˆªå™¨å®ç°ï¼Œæä¾›å£°æ˜å¼äº‹åŠ¡ç®¡ç†åŠŸèƒ½ã€‚å®ƒåˆ©ç”¨äº†Springçš„ä»£ç†æœºåˆ¶ï¼ˆJDKåŠ¨æ€ä»£ç†æˆ–CGLIBï¼‰ï¼Œåœ¨è¿è¡Œæ—¶ä¸ºæ ‡æ³¨@Transactionalçš„Beanåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œé€šè¿‡æ‹¦æˆªå™¨æ·»åŠ äº‹åŠ¡ç®¡ç†é€»è¾‘ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
<p>Springå¦‚ä½•é€‰æ‹©JDKä»£ç†è¿˜æ˜¯CGLIBä»£ç†ï¼š</p>
<div class="gap"></div>
<p>// Spring Bootçš„é…ç½®</p>
<pre><code>@Configuration</code></pre>
<pre><code>@EnableAspectJAutoProxy(proxyTargetClass = true)  // true=CGLIB, false=JDK</code></pre>
<pre><code>public class AppConfig {
}</code></pre>
<div class="gap"></div>
<p>// æˆ–è€…application.propertiesé…ç½®</p>
<p>// spring.aop.proxy-target-class=true  # å¼ºåˆ¶ä½¿ç”¨CGLIB</p>
<div class="gap"></div>
<p>**é€‰æ‹©ç­–ç•¥ï¼š**</p>
<p>é»˜è®¤æƒ…å†µï¼š</p>
<p>ç›®æ ‡ç±»å®ç°äº†æ¥å£ â†’ ä½¿ç”¨JDKåŠ¨æ€ä»£ç†</p>
<p>ç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ â†’ ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†</p>
<div class="gap"></div>
<p>å¼ºåˆ¶ä½¿ç”¨CGLIBï¼š</p>
<p>è®¾ç½®proxyTargetClass = true</p>
<p>ç»Ÿä¸€ä½¿ç”¨CGLIBï¼Œé¿å…ç±»å‹è½¬æ¢é—®é¢˜</p>
<div class="gap"></div>
<p>5.2 äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ˆPropagationï¼‰</p>
<p>ä¼ æ’­è¡Œä¸ºå®šä¹‰äº†å¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶ï¼Œäº‹åŠ¡å¦‚ä½•ä¼ æ’­ã€‚</p>
<div class="gap"></div>
<p>7ç§ä¼ æ’­è¡Œä¸ºè¯¦è§£</p>
<pre><code>import org.springframework.transaction.annotation.Propagation;</code></pre>
<pre><code>import org.springframework.transaction.annotation.Transactional;</code></pre>
<div class="gap"></div>
<pre><code>@Service</code></pre>
<pre><code>public class OrderService {
    
    @Autowired
    private UserService userService;
    
    // REQUIREDï¼ˆé»˜è®¤ï¼‰ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°äº‹åŠ¡
    @Transactional(propagation = Propagation.REQUIRED)
    public void placeOrder(Order order) {
        // æ–¹æ³•Açš„äº‹åŠ¡
        saveOrder(order);
        
        try {
            // è°ƒç”¨å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•
            userService.updateUserPoints(order.getUserId(), order.getPoints());
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†
        }
        // REQUIREDï¼šupdateUserPointsåŠ å…¥placeOrderçš„äº‹åŠ¡
        // å¦‚æœupdateUserPointsæŠ›å‡ºå¼‚å¸¸ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»šï¼ˆåŒ…æ‹¬saveOrderï¼‰
    }
}</code></pre>
<div class="gap"></div>
<pre><code>@Service</code></pre>
<pre><code>public class UserService {
    
    // REQUIRES_NEWï¼šæ— è®ºå½“å‰æ˜¯å¦å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void updateUserPoints(Long userId, Integer points) {
        // åˆ›å»ºæ–°äº‹åŠ¡ï¼Œä¸è°ƒç”¨æ–¹çš„äº‹åŠ¡ç‹¬ç«‹
        // è‡ªå·±çš„æäº¤/å›æ»šä¸å½±å“è°ƒç”¨æ–¹äº‹åŠ¡
    }
    
    // NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œ
    @Transactional(propagation = Propagation.NESTED)
    public void logUserAction(UserAction action) {
        // åµŒå¥—äº‹åŠ¡ï¼šå¤–éƒ¨äº‹åŠ¡å›æ»šä¼šå¯¼è‡´åµŒå¥—äº‹åŠ¡å›æ»š
        // ä½†åµŒå¥—äº‹åŠ¡å¯ä»¥ç‹¬ç«‹å›æ»šè€Œä¸å½±å“å¤–éƒ¨äº‹åŠ¡
    }
    
    // SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥äº‹åŠ¡ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ
    @Transactional(propagation = Propagation.SUPPORTS)
    public User getUser(Long id) {
        // æŸ¥è¯¢æ–¹æ³•ï¼Œä¸éœ€è¦å¼ºåˆ¶äº‹åŠ¡
    }
    
    // NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡åˆ™æŒ‚èµ·
    @Transactional(propagation = Propagation.NOT_SUPPORTED)
    public void sendNotification(Notification notification) {
        // å‘æ¶ˆæ¯ã€æ—¥å¿—ç­‰éæ•°æ®åº“æ“ä½œ
    }
    
    // MANDATORYï¼šå¼ºåˆ¶å¿…é¡»åœ¨äº‹åŠ¡ä¸­è°ƒç”¨ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸
    @Transactional(propagation = Propagation.MANDATORY)
    public void auditLog(AuditLog log) {
        // å¿…é¡»åœ¨å¤–å±‚äº‹åŠ¡ä¸­è°ƒç”¨
    }
    
    // NEVERï¼šå¿…é¡»åœ¨éäº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸
    @Transactional(propagation = Propagation.NEVER)
    public String generateReport() {
        // ç”ŸæˆæŠ¥è¡¨ï¼Œä¸å¸Œæœ›è¢«äº‹åŠ¡å½±å“æ€§èƒ½
    }
}</code></pre>
<div class="gap"></div>
<p>5.3 éš”ç¦»çº§åˆ«ï¼ˆIsolationï¼‰</p>
<div class="gap"></div>
<p>å¹¶å‘é—®é¢˜ä¸éš”ç¦»çº§åˆ«å¯¹åº”å…³ç³»</p>
<p>éš”ç¦»çº§åˆ«	è„è¯»	ä¸å¯é‡å¤è¯»	å¹»è¯»	æ€§èƒ½</p>
<p>READ_UNCOMMITTED	å¯èƒ½	å¯èƒ½	å¯èƒ½	æœ€é«˜</p>
<p>READ_COMMITTED	é¿å…	å¯èƒ½	å¯èƒ½	é«˜</p>
<p>REPEATABLE_READ	é¿å…	é¿å…	å¯èƒ½	ä¸­</p>
<p>SERIALIZABLE	é¿å…	é¿å…	é¿å…	æœ€ä½</p>
<div class="gap"></div>
<p>5.4 å£°æ˜å¼äº‹åŠ¡ä¸ç¼–ç¨‹å¼äº‹åŠ¡çš„åŒºåˆ«ã€‚</p>
<div class="gap"></div>
<p>ç‰¹æ€§	å£°æ˜å¼äº‹åŠ¡	ç¼–ç¨‹å¼äº‹åŠ¡</p>
<p>å®ç°æ–¹å¼	é€šè¿‡æ³¨è§£æˆ–XMLé…ç½®	é€šè¿‡ç¼–ç¨‹ä»£ç æ‰‹åŠ¨æ§åˆ¶</p>
<p>ä¾µå…¥æ€§	éä¾µå…¥å¼ï¼ˆä¸å½±å“ä¸šåŠ¡é€»è¾‘ï¼‰	ä¾µå…¥å¼ï¼ˆä¸ä¸šåŠ¡ä»£ç è€¦åˆï¼‰</p>
<p>æ ¸å¿ƒç»„ä»¶	@Transactional æ³¨è§£ã€AOPä»£ç†	TransactionTemplateã€PlatformTransactionManager</p>
<p>ä½¿ç”¨åœºæ™¯	å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯	éœ€è¦ç²¾ç»†æ§åˆ¶çš„å¤æ‚åœºæ™¯</p>
<div class="gap"></div>
<p>ä»£ç ç®€æ´æ€§	âœ… ç®€æ´ï¼Œä¸€è¡Œæ³¨è§£	âŒ ä»£ç å†—é•¿ï¼Œéœ€è¦æ¨¡æ¿ä»£ç </p>
<p>ä¸šåŠ¡é€»è¾‘åˆ†ç¦»	âœ… äº‹åŠ¡ç®¡ç†ä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨åˆ†ç¦»	âŒ äº‹åŠ¡ä»£ç ä¸ä¸šåŠ¡é€»è¾‘æ··åˆ</p>
<p>çµæ´»æ€§	âŒ ç›¸å¯¹å›ºå®šï¼Œé…ç½®æœ‰é™	âœ… æé«˜çµæ´»æ€§ï¼Œå¯åŠ¨æ€æ§åˆ¶</p>
<p>å¯è¯»æ€§	âœ… æ¸…æ™°ç›´è§‚ï¼Œå…³æ³¨ä¸šåŠ¡	âŒ äº‹åŠ¡ä»£ç å¹²æ‰°ä¸šåŠ¡é€»è¾‘</p>
<p>æ€§èƒ½	ç¨æœ‰å¼€é”€ï¼ˆAOPä»£ç†ï¼‰	ç›´æ¥æ§åˆ¶ï¼Œå¼€é”€è¾ƒå°</p>
<p>é”™è¯¯å¤„ç†	è‡ªåŠ¨å›æ»šï¼ˆå£°æ˜å¼‚å¸¸ï¼‰	å¯ç²¾ç»†æ§åˆ¶å›æ»šæ—¶æœº</p>
<p>é€‚ç”¨åœºæ™¯	æ ‡å‡†CRUDã€å¸¸è§„ä¸šåŠ¡	å¤æ‚ä¸šåŠ¡æµã€éœ€è¦æ¡ä»¶æäº¤/å›æ»š</p>
<div class="gap"></div>
<p>å£°æ˜å¼äº‹åŠ¡ï¼ˆå·¥ä½œåŸç†ï¼šAOPä»£ç†ï¼‰ï¼š</p>
<pre><code>@Service</code></pre>
<pre><code>public class UserService {
    
    // æœ€ç®€å•çš„å£°æ˜å¼äº‹åŠ¡
    @Transactional
    public void updateUser(User user) {
        // ä¸šåŠ¡é€»è¾‘
        userRepository.save(user);
        // å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡è‡ªåŠ¨å›æ»š
    }
    
    // å¸¦é…ç½®çš„å£°æ˜å¼äº‹åŠ¡
    @Transactional(
        propagation = Propagation.REQUIRED,
        isolation = Isolation.DEFAULT,
        rollbackFor = Exception.class,
        timeout = 30
    )
    public void batchUpdate(List&lt;User&gt; users) {
        // æ‰¹é‡æ“ä½œ
    }
}</code></pre>
<div class="gap"></div>
<p>ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¾‹å¦‚TransactionTemplateæ–¹å¼ï¼š</p>
<pre><code>@Service</code></pre>
<pre><code>public class OrderService {
    
    @Autowired
    private TransactionTemplate transactionTemplate;
    
    public void complexOrderProcess(Order order) {
        // ä½¿ç”¨TransactionTemplateæ‰§è¡Œäº‹åŠ¡
        transactionTemplate.execute(status -&gt; {
            try {
                // æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•
                orderRepository.save(order);
                
                // æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜
                inventoryService.deduct(order);
                
                // æ­¥éª¤3ï¼šè®°å½•æ—¥å¿—
                logService.record(order);
                
                // æ‰‹åŠ¨è®¾ç½®åªè¯»ï¼ˆå¦‚æœéœ€è¦ï¼‰
                // status.setRollbackOnly(); // æ‰‹åŠ¨å›æ»š
                
                return true;
            } catch (Exception e) {
                // å‘ç”Ÿå¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»š
                // ä¹Ÿå¯ä»¥æ‰‹åŠ¨å›æ»šï¼šstatus.setRollbackOnly();
                throw e;
            }
        });
    }
}</code></pre>
<div class="gap"></div>
<div class="gap"></div>
<p>5.5 Exception VS Error</p>
<div class="gap"></div>
<p>ç‰¹æ€§	Exception	Error</p>
<p>ç»§æ‰¿å…³ç³»	Throwable â† Exception	Throwable â† Error</p>
<p>å¯æ¢å¤æ€§	âœ… å¯æ¢å¤ï¼ˆé€šè¿‡æ•è·å¤„ç†ï¼‰	âŒ ä¸å¯æ¢å¤ï¼ˆä¸¥é‡ç³»ç»Ÿé—®é¢˜ï¼‰</p>
<p>äº§ç”ŸåŸå› 	ç¨‹åºé€»è¾‘é—®é¢˜ã€å¤–éƒ¨æ¡ä»¶å˜åŒ–	JVMç³»ç»Ÿçº§é—®é¢˜ã€èµ„æºè€—å°½</p>
<p>å¤„ç†å»ºè®®	åº”è¯¥æ•è·å¹¶å¤„ç†	ä¸åº”è¯¥æ•è·ï¼ˆæ•è·ä¹Ÿæ— æ„ä¹‰ï¼‰</p>
<p>å­ç±»ç¤ºä¾‹	IOException, SQLException, NullPointerException	OutOfMemoryError, StackOverflowError, VirtualMachineError</p>
<p>æ˜¯å¦å—æ£€	åˆ†ä¸ºCheckedå’ŒUnchecked	å…¨éƒ¨æ˜¯Uncheckedï¼ˆè¿è¡Œæ—¶ï¼‰</p>
<div class="gap"></div>
<p>// Javaå¼‚å¸¸ä½“ç³»å®Œæ•´è§†å›¾</p>
<pre><code>        Throwable (å¯æŠ›å‡º)
          /      \
     Error       Exception
                   /     \
              RuntimeException  å…¶ä»–Checked Exception
                  |
         å„ç§Unchecked Exception</code></pre>
<p>// ä»£ç è¡¨ç¤º</p>
<p>Object</p>
<p>  â””â”€ Throwable</p>
<pre><code>      â”œâ”€ Error (ç³»ç»Ÿé”™è¯¯ï¼Œä¸å¯æ¢å¤)
      â”‚    â”œâ”€ VirtualMachineError
      â”‚    â”‚    â”œâ”€ OutOfMemoryError
      â”‚    â”‚    â”œâ”€ StackOverflowError
      â”‚    â”‚    â””â”€ InternalError
      â”‚    â”œâ”€ LinkageError
      â”‚    â”‚    â”œâ”€ NoClassDefFoundError
      â”‚    â”‚    â””â”€ ClassFormatError
      â”‚    â””â”€ AssertionError
      â”‚
      â””â”€ Exception (å¼‚å¸¸ï¼Œå¯æ¢å¤)
           â”œâ”€ RuntimeException (Unchecked)
           â”‚    â”œâ”€ NullPointerException
           â”‚    â”œâ”€ IllegalArgumentException
           â”‚    â”œâ”€ IndexOutOfBoundsException
           â”‚    â”œâ”€ ClassCastException
           â”‚    â””â”€ ArithmeticException
           â”‚
           â””â”€ Checked Exception (å¿…é¡»å¤„ç†)
                â”œâ”€ IOException
                â”‚    â”œâ”€ FileNotFoundException
                â”‚    â””â”€ EOFException
                â”œâ”€ SQLException
                â”œâ”€ ParseException
                â”œâ”€ InterruptedException
                â””â”€ ClassNotFoundException</code></pre>
<h2 id="h-6" class="heading level-1">6. æ•°æ®åº“è¿æ¥æ± </h2>
<div class="gap"></div>
<p>6.1 é»˜è®¤è¿æ¥æ± ï¼ˆHikariCPï¼‰çš„é…ç½®ä¼˜åŒ–ã€‚</p>
<div class="gap"></div>
<p>è¿æ¥æ± çš„æ ¸å¿ƒå‚æ•°</p>
<p>å‚æ•°	è¯´æ˜	é»˜è®¤å€¼/å»ºè®®</p>
<p>maximumPoolSize	æœ€å¤§è¿æ¥æ•°	CPUæ ¸æ•° * 2 ï¼ˆå¦‚æœæ˜¯Webï¼Œå¯ä»¥å¤šç‚¹ï¼‰</p>
<p>minimumIdle	æœ€å°ç©ºé—²è¿æ¥	åŒmaximumPoolSize</p>
<p>connectionTimeout	è¿æ¥è·å–è¶…æ—¶	30ç§’</p>
<p>idleTimeout	ç©ºé—²è¿æ¥è¶…æ—¶	10åˆ†é’Ÿ</p>
<p>maxLifetime	è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ	30åˆ†é’Ÿ</p>
<p>validationTimeout	éªŒè¯æŸ¥è¯¢è¶…æ—¶	5ç§’</p>
<div class="gap"></div>
<div class="gap"></div>
<p># é…ç½®å‚è€ƒè¡¨æ ¼</p>
<p>åº”ç”¨ç±»å‹         | å¹¶å‘ç‰¹ç‚¹           | æ¨èèŒƒå›´     | è®¡ç®—åŸºå‡†</p>
<p>----------------|-------------------|-------------|----------</p>
<p>ç”µå•†è®¢å•æœåŠ¡     | é«˜å¹¶å‘ï¼ŒçŸ­è¿æ¥     | 50-200      | CPUæ ¸å¿ƒ Ã— 8</p>
<p>å†…å®¹ç®¡ç†ç³»ç»Ÿ     | ä¸­ç­‰å¹¶å‘ï¼Œè¯»å¤šå†™å°‘ | 20-50       | CPUæ ¸å¿ƒ Ã— 4</p>
<p>æ•°æ®åˆ†æå¹³å°     | ä½å¹¶å‘ï¼Œé•¿æŸ¥è¯¢     | 10-30       | CPUæ ¸å¿ƒ Ã— 2</p>
<p>APIç½‘å…³         | æé«˜å¹¶å‘ï¼Œå¿«é€Ÿå“åº” | 100-300     | CPUæ ¸å¿ƒ Ã— 10</p>
<div class="gap"></div>
<p>æœ¬åœ°å¼€å‘ï¼šç”¨10-20è¶³å¤Ÿäº†ï¼Œèµ„æºç•™ç»™å…¶ä»–åº”ç”¨</p>
<p>æµ‹è¯•ç¯å¢ƒï¼š20-50ï¼Œæ¨¡æ‹Ÿç”Ÿäº§å¹¶å‘</p>
<p>ç”Ÿäº§ç¯å¢ƒï¼š</p>
<p>  èµ·ç‚¹ï¼šä»CPUé€»è¾‘æ ¸å¿ƒæ•°Ã—4å¼€å§‹</p>
<p>  ä¼˜åŒ–ï¼šé€šè¿‡ç›‘æ§å’Œå‹æµ‹è°ƒæ•´</p>
<p>  ä¸Šé™ï¼šä¸è¶…è¿‡æ•°æ®åº“é™åˆ¶çš„80%</p>
<p>ç›‘æ§æŒ‡æ ‡ï¼š</p>
<p>  - Active Connections: æ´»è·ƒè¿æ¥æ•°ï¼ˆåº”å°äºmaximumPoolSizeçš„80%ï¼‰</p>
<p>  - Idle Connections: ç©ºé—²è¿æ¥æ•°</p>
<p>  - Connection Wait Time: è·å–è¿æ¥ç­‰å¾…æ—¶é—´ï¼ˆåº”&lt;100msï¼‰</p>
<p>  - Connection Timeout Count: è¿æ¥è¶…æ—¶æ¬¡æ•°ï¼ˆåº”ä¸º0ï¼‰</p>
<div class="gap"></div>
<p>ç›‘æ§æ•°æ®åº“è¿æ¥ä½¿ç”¨ç‡</p>
<p>SHOW PROCESSLIST;  -- æŸ¥çœ‹å½“å‰è¿æ¥</p>
<p>SHOW STATUS LIKE &#x27;Threads_connected&#x27;;  -- æ€»è¿æ¥æ•°</p>
<p>SHOW VARIABLES LIKE &#x27;max_connections&#x27;;  -- æœ€å¤§è¿æ¥æ•°</p>
<div class="gap"></div>
<p>ä½ çš„maximumPoolSizeæ€ä¹ˆç¡®å®šçš„ï¼Ÿ</p>
<p>1ï¼‰ ç†è®ºåŸºå‡†ï¼ˆå±•ç¤ºçŸ¥è¯†ï¼‰ï¼š</p>
<p>   &quot;æˆ‘ä¼šå‚è€ƒå¤šä¸ªå› ç´ ï¼Œè€Œä¸æ˜¯ç®€å•å¥—ç”¨å…¬å¼ã€‚é¦–å…ˆä¼šåŸºäºCPUæ ¸å¿ƒæ•°ä½œä¸ºèµ·ç‚¹ï¼Œ</p>
<p>   ç°ä»£SSDç¯å¢ƒä¸‹ï¼Œç£ç›˜æ•°ä¸å†é‡è¦ï¼Œæ›´å¤šè€ƒè™‘å¹¶å‘ç‰¹æ€§ã€‚&quot;</p>
<div class="gap"></div>
<p>2ï¼‰ å®é™…æ–¹æ³•ï¼ˆå±•ç¤ºç»éªŒï¼‰ï¼š</p>
<p>   &quot;åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä¼šï¼š</p>
<p>   a) å…ˆç”¨ä¿å®ˆå€¼ï¼ˆå¦‚20ï¼‰å¯åŠ¨</p>
<p>   b) è¿›è¡Œå‹æµ‹ï¼Œè§‚å¯Ÿæ€§èƒ½æ‹ç‚¹</p>
<p>   c) ç›‘æ§ç”Ÿäº§ç¯å¢ƒè¿æ¥ä½¿ç”¨ç‡</p>
<p>   d) æ ¹æ®ä¸šåŠ¡å¢é•¿åŠ¨æ€è°ƒæ•´&quot;</p>
<div class="gap"></div>
<p>3ï¼‰ å…·ä½“æ•°å€¼ï¼ˆå±•ç¤ºä¸“ä¸šæ€§ï¼‰ï¼š</p>
<p>   &quot;å¯¹äºæˆ‘ä»¬çš„ç”µå•†è®¢å•æœåŠ¡ï¼š</p>
<p>   - CPUï¼š16æ ¸</p>
<p>   - ç†è®ºæœ€å¤§ï¼š16Ã—8=128</p>
<p>   - å®é™…é…ç½®ï¼š80ï¼ˆç•™å‡ºbufferï¼‰</p>
<p>   - ç›‘æ§æ˜¾ç¤ºï¼šå³°å€¼ä½¿ç”¨60ï¼Œå¹³å‡30&quot;</p>
<div class="gap"></div>
<p>4ï¼‰ å®‰å…¨è€ƒè™‘ï¼ˆå±•ç¤ºå‘¨å…¨æ€§ï¼‰ï¼š</p>
<p>   &quot;åŒæ—¶æˆ‘ä¼šç¡®ä¿ï¼š</p>
<p>   - ä¸è¶…è¿‡æ•°æ®åº“max_connectionsçš„80%</p>
<p>   - è®¾ç½®åˆç†çš„connection-timeouté˜²æ­¢çº¿ç¨‹é˜»å¡</p>
<p>   - å¼€å¯leak-detectionæ£€æµ‹è¿æ¥æ³„éœ²&quot;</p>
<div class="gap"></div>
<div class="gap"></div>
<p>HikariCPæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„JDBCè¿æ¥æ± :</p>
<p>æ€§èƒ½å¯¹æ¯”ï¼šHikariCP &gt; Druid &gt; Tomcat JDBC &gt; DBCP2</p>
<p>å†…å­˜æ¶ˆè€—ï¼šHikariCP &lt; å…¶ä»–è¿æ¥æ± </p>
<div class="gap"></div>
<p>1ï¼‰æ•°æ®åº“è¿æ¥æ± è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>ç­”ï¼šè§£å†³äº†é¢‘ç¹åˆ›å»º/å…³é—­æ•°æ®åº“è¿æ¥çš„æ€§èƒ½é—®é¢˜ï¼š</p>
<p>A. å‡å°‘è¿æ¥åˆ›å»ºå¼€é”€ï¼ˆTCPä¸‰æ¬¡æ¡æ‰‹ã€è®¤è¯ç­‰ï¼‰</p>
<p>B. æ§åˆ¶å¹¶å‘è¿æ¥æ•°ï¼Œä¿æŠ¤æ•°æ®åº“</p>
<p>C. ç»Ÿä¸€ç®¡ç†è¿æ¥çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ</p>
<p>D. æä¾›è¿æ¥å¤ç”¨ï¼Œæå‡å“åº”é€Ÿåº¦</p>
<div class="gap"></div>
<p>6.2 å¤šæ•°æ®æºé…ç½®ã€‚</p>
<div class="gap"></div>
<div class="gap"></div>
<div class="gap"></div>
                </main>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ“– æŒç»­å­¦ä¹ ï¼Œä¸æ–­è¿›æ­¥ Â· æœ€åæ›´æ–°ï¼š2026å¹´2æœˆ</p>
        </div>
    </div>
    
    <script>
        function switchTab(index) {
            // åˆ‡æ¢æ ‡ç­¾
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            
            // åˆ‡æ¢é¢æ¿
            document.querySelectorAll('.tab-panel').forEach((panel, i) => {
                panel.classList.toggle('active', i === index);
            });
            
            // ç§»åŠ¨ç«¯ï¼šæ”¶èµ·æ‰€æœ‰ç›®å½•
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.toc-tree').forEach(toc => {
                    toc.classList.add('collapsed');
                });
                document.querySelectorAll('.toggle-icon').forEach(icon => {
                    icon.textContent = 'â–¼';
                });
            }
        }
        
        // åˆ‡æ¢ç›®å½•æ˜¾ç¤º/éšè—ï¼ˆç§»åŠ¨ç«¯ï¼‰
        function toggleToc(button) {
            const sidebar = button.closest('.sidebar');
            const tocTree = sidebar.querySelector('.toc-tree');
            const icon = button.querySelector('.toggle-icon');
            
            tocTree.classList.toggle('collapsed');
            icon.textContent = tocTree.classList.contains('collapsed') ? 'â–¼' : 'â–²';
        }
        
        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('.toc-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // è·å–ç›®æ ‡å…ƒç´ ID
                const targetId = this.getAttribute('href').substring(1);
                
                // æ‰¾åˆ°å½“å‰æ¿€æ´»çš„tab-panel
                const activePanel = document.querySelector('.tab-panel.active');
                
                if (activePanel) {
                    // åœ¨æ¿€æ´»çš„é¢æ¿ä¸­æŸ¥æ‰¾ç›®æ ‡å…ƒç´ 
                    const targetElement = activePanel.querySelector('#' + targetId);
                    const mainContent = activePanel.querySelector('.main');
                    
                    if (targetElement && mainContent) {
                        // ç§»åŠ¨ç«¯åˆ¤æ–­
                        const isMobile = window.innerWidth <= 768;
                        
                        if (isMobile) {
                            // ç§»åŠ¨ç«¯ï¼šæ”¶èµ·ç›®å½•å¹¶æ»šåŠ¨é¡µé¢
                            const tocTree = this.closest('.toc-tree');
                            if (tocTree) {
                                tocTree.classList.add('collapsed');
                                const toggleBtn = activePanel.querySelector('.mobile-toc-toggle');
                                if (toggleBtn) {
                                    const icon = toggleBtn.querySelector('.toggle-icon');
                                    if (icon) icon.textContent = 'â–¼';
                                }
                            }
                            
                            // æ»šåŠ¨åˆ°ç›®æ ‡å…ƒç´ ï¼ˆç›¸å¯¹äºæ•´ä¸ªå®¹å™¨ï¼‰
                            setTimeout(() => {
                                targetElement.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'start'
                                });
                            }, 100);
                        } else {
                            // æ¡Œé¢ç«¯ï¼šåœ¨ä¸»å†…å®¹åŒºå†…æ»šåŠ¨
                            const targetPosition = targetElement.offsetTop - mainContent.offsetTop - 20;
                            mainContent.scrollTo({
                                top: targetPosition,
                                behavior: 'smooth'
                            });
                        }
                    }
                }
            });
        });
        
        // åˆå§‹åŒ–ï¼šç§»åŠ¨ç«¯é»˜è®¤æ”¶èµ·ç›®å½•
        if (window.innerWidth <= 768) {
            document.querySelectorAll('.toc-tree').forEach(toc => {
                toc.classList.add('collapsed');
            });
        }
    </script>
</body>
</html>